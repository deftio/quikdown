<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>SVG Simple Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        #editor {
            height: 400px;
            border: 2px solid #007bff;
            border-radius: 4px;
        }
        
        button {
            margin: 10px;
            padding: 10px 20px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        #output {
            background: #f0f0f0;
            padding: 10px;
            margin-top: 20px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow: auto;
        }
    </style>
</head>
<body>
    <h1>SVG Simple Test</h1>
    
    <div id="editor"></div>
    <button onclick="inspectSVG()">Inspect SVG Container</button>
    <button onclick="testRoundTrip()">Test Round Trip</button>
    <div id="output"></div>
    
    <script type="module">
        import QuikdownEditor from '../../dist/quikdown_edit.esm.min.js';
        
        window.editor = new QuikdownEditor('#editor', { 
            mode: 'split'
        });
        
        const testContent = `# Test

\`\`\`svg
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100">
  <circle cx="50" cy="50" r="40" fill="blue"/>
</svg>
\`\`\`

Edit this text.`;
        
        editor.setMarkdown(testContent);
        
        window.inspectSVG = function() {
            const output = document.getElementById('output');
            const container = editor.previewPanel.querySelector('.qde-svg-container');
            
            if (container) {
                output.textContent = 'SVG Container found:\n';
                output.textContent += '  contenteditable: ' + container.getAttribute('contenteditable') + '\n';
                output.textContent += '  data-qd-fence: ' + container.getAttribute('data-qd-fence') + '\n';
                output.textContent += '  data-qd-lang: ' + container.getAttribute('data-qd-lang') + '\n';
                output.textContent += '  data-qd-source length: ' + (container.getAttribute('data-qd-source')?.length || 0) + '\n';
                output.textContent += '  data-qd-source (first 100 chars): ' + container.getAttribute('data-qd-source')?.substring(0, 100) + '\n';
                output.textContent += '\nFull data-qd-source:\n' + container.getAttribute('data-qd-source');
            } else {
                output.textContent = 'No SVG container found';
            }
        };
        
        window.testRoundTrip = function() {
            const output = document.getElementById('output');
            
            // Get current markdown
            const before = editor.getMarkdown();
            
            // Simulate editing by triggering input event on preview
            const p = editor.previewPanel.querySelector('p');
            if (p) {
                p.textContent = 'Edited text.';
                editor.previewPanel.dispatchEvent(new Event('input'));
            }
            
            // Get markdown after
            setTimeout(() => {
                const after = editor.getMarkdown();
                output.textContent = 'BEFORE:\n' + before + '\n\nAFTER:\n' + after;
                
                if (after.includes('```svg\n\n```')) {
                    output.textContent += '\n\n⚠️ ERROR: SVG content was lost!';
                } else if (after.includes('<svg')) {
                    output.textContent += '\n\n✅ SUCCESS: SVG content preserved';
                }
            }, 100);
        };
    </script>
</body>
</html>