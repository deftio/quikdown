/**
 * quikdown_bd - Bidirectional Markdown Parser
 * @version 1.0.5dev1
 * @license BSD-2-Clause
 * @copyright DeftIO 2025
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).quikdown_bd=t()}(this,function(){"use strict";const e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};function t(t){return t.replace(/[&<>"']/g,t=>e[t])}function n(e,n={}){if(!e||"string"!=typeof e)return"";const{fence_plugin:o,inline_styles:a=!1,bidirectional:i=!0}=n;i||(n.bidirectional=!1);const c=function(e,n){return function(r,o="",a=""){let i="";if(a&&(i+=` data-qd="${t(a)}"`),e){const e=n[r];(e||o)&&(i+=` style="${o?e?`${e};${o}`:o:e}"`)}else i+=` class="quikdown-${r}"`;return i}}(a,{h1:"font-size:2em;font-weight:600;margin:.67em 0;text-align:left",h2:"font-size:1.5em;font-weight:600;margin:.83em 0",h3:"font-size:1.25em;font-weight:600;margin:1em 0",h4:"font-size:1em;font-weight:600;margin:1.33em 0",h5:"font-size:.875em;font-weight:600;margin:1.67em 0",h6:"font-size:.85em;font-weight:600;margin:2em 0",pre:"background:#f4f4f4;padding:10px;border-radius:4px;overflow-x:auto;margin:1em 0",code:"background:#f0f0f0;padding:2px 4px;border-radius:3px;font-family:monospace",blockquote:"border-left:4px solid #ddd;margin-left:0;padding-left:1em",table:"border-collapse:collapse;width:100%;margin:1em 0",th:"border:1px solid #ddd;padding:8px;background-color:#f2f2f2;font-weight:bold;text-align:left",td:"border:1px solid #ddd;padding:8px;text-align:left",hr:"border:none;border-top:1px solid #ddd;margin:1em 0",img:"max-width:100%;height:auto",a:"color:#06c;text-decoration:underline",strong:"font-weight:bold",em:"font-style:italic",del:"text-decoration:line-through",ul:"margin:.5em 0;padding-left:2em",ol:"margin:.5em 0;padding-left:2em",li:"margin:.25em 0","task-item":"list-style:none","task-checkbox":"margin-right:.5em"});let l=e;const s=[],d=[];return l=l.replace(/^(```|~~~)([^\n]*)\n([\s\S]*?)^\1$/gm,(e,n,r,a)=>{const i=`§CB${s.length}§`,c=r.trim();return o&&"function"==typeof o?s.push({fence:n,lang:c,code:a.trimEnd(),custom:!0}):s.push({fence:n,lang:c,code:t(a.trimEnd()),custom:!1}),i}),l=l.replace(/`([^`]+)`/g,(e,n)=>{const r=`§IC${d.length}§`;return d.push({code:t(n),original:e}),r}),l=t(l),l=l.replace(/^(#{1,6})\s+(.+?)\s*#*$/gm,(e,t,n)=>{const r=t.length;return`<h${r}${c("h"+r,"",t)}>${n}</h${r}>`}),l=l.replace(/\*\*(.+?)\*\*/g,`<strong${c("strong","","**")}>$1</strong>`),l=l.replace(/__(.+?)__/g,`<strong${c("strong","","__")}>$1</strong>`),l=l.replace(/(?<!\*)\*(?!\*)(.+?)(?<!\*)\*(?!\*)/g,`<em${c("em","","*")}>$1</em>`),l=l.replace(/(?<!_)_(?!_)(.+?)(?<!_)_(?!_)/g,`<em${c("em","","_")}>$1</em>`),l=l.replace(/~~(.+?)~~/g,`<del${c("del","","~~")}>$1</del>`),l=l.replace(/^&gt;\s+(.+)$/gm,`<blockquote${c("blockquote","",">")}>$1</blockquote>`),l=l.replace(/<\/blockquote>\n<blockquote[^>]*>/g,"\n"),l=l.replace(/^---+$/gm,`<hr${c("hr","","---")}>`),l=function(e,t){const n=e.split("\n"),r=[];let o=[];for(let e=0;e<n.length;e++){const a=n[e],i=a.match(/^(\s*)([*\-+]|\d+\.)\s+(.+)$/);if(i){const[,e,n,a]=i,c=Math.floor(e.length/2),l=/^\d+\./.test(n),s=l?"ol":"ul",d=l?"1.":n;let u=a,g="";const p=a.match(/^\[([x ])\]\s+(.*)$/i);if(p&&!l){const[,e,n]=p,r="x"===e.toLowerCase();u=`<input type="checkbox"${t("task-checkbox","","[")}${r?" checked":""}> ${n}`,g=t("task-item","","- [ ]")}for(;o.length>c+1;){const e=o.pop();r.push(`</${e.type}>`)}o.length===c&&(o.push({type:s,level:c,marker:d}),r.push(`<${s}${t(s,"",d)}>`));const f=g||t("li","",d);r.push(`<li${f}>${u}</li>`)}else{for(;o.length>0;){const e=o.pop();r.push(`</${e.type}>`)}r.push(a)}}for(;o.length>0;){const e=o.pop();r.push(`</${e.type}>`)}return r.join("\n")}(l,c),l=l.replace(/!\[([^\]]*)\]\(([^)]+)\)/g,(e,n,r)=>`<img${c("img","","!")} src="${r}" alt="${n}" data-qd-alt="${t(n)}" data-qd-src="${t(r)}">`),l=l.replace(/\[([^\]]+)\]\(([^)]+)\)/g,(e,n,r)=>`<a${c("a","","[")} href="${r}" data-qd-text="${t(n)}">${n}</a>`),l=function(e,t){const n=e.split("\n"),o=[];let a=!1,i=[];for(let e=0;e<n.length;e++){const c=n[e].trim();if(c.includes("|"))a||(a=!0,i=[]),i.push(c);else{if(a){const e=r(i,t);e?o.push(e):o.push(...i),a=!1,i=[]}o.push(n[e])}}if(a&&i.length>0){const e=r(i,t);e?o.push(e):o.push(...i)}return o.join("\n")}(l,c),l=l.replace(/  $/gm,'<br data-qd="  ">'),l=l.replace(/\n\n+/g,"</p><p>"),l="<p>"+l+"</p>",l=l.replace(/<p><\/p>/g,""),l=l.replace(/<p>(<h[1-6][^>]*>)/g,"$1"),l=l.replace(/(<\/h[1-6]>)<\/p>/g,"$1"),l=l.replace(/<p>(<blockquote[^>]*>)/g,"$1"),l=l.replace(/(<\/blockquote>)<\/p>/g,"$1"),l=l.replace(/<p>(<ul[^>]*>|<ol[^>]*>)/g,"$1"),l=l.replace(/(<\/ul>|<\/ol>)<\/p>/g,"$1"),l=l.replace(/<p>(<hr[^>]*>)<\/p>/g,"$1"),l=l.replace(/<p>(<table[^>]*>)/g,"$1"),l=l.replace(/(<\/table>)<\/p>/g,"$1"),s.forEach((e,n)=>{const r=`§CB${n}§`;let a;e.custom&&o?(a=o(e.code,e.lang),void 0===a&&(a=`<pre${c("pre","",e.fence)}><code data-qd-lang="${e.lang}">${t(e.code)}</code></pre>`)):a=`<pre${c("pre","",e.fence)} data-qd-fence="${e.fence}" data-qd-lang="${e.lang}"><code>${e.code}</code></pre>`,l=l.replace(r,a)}),d.forEach((e,t)=>{const n=`§IC${t}§`;l=l.replace(n,`<code${c("code","","`")}>${e.code}</code>`)}),l.trim()}function r(e,n){if(e.length<2)return null;let r=-1,o=[];for(let t=1;t<e.length;t++)if(/^\|?[\s\-:|]+\|?$/.test(e[t])&&e[t].includes("-")){r=t;const n=e[t].replace(/^\|/,"").replace(/\|$/,"").split("|");o=n.map(e=>{const t=e.trim();return t.startsWith(":")&&t.endsWith(":")?"center":t.endsWith(":")?"right":"left"});break}if(-1===r)return null;let a=`<table${n("table","","|")} data-qd-align="${o.join(",")}">\n`;if(r>0){a+=`<thead${n("thead","","|")}>\n<tr${n("tr","","|")}>\n`;e[0].replace(/^\|/,"").replace(/\|$/,"").split("|").forEach((e,r)=>{const i=o[r]&&"left"!==o[r]?`text-align:${o[r]}`:"";a+=`<th${n("th",i,"|")} data-qd-align="${o[r]||"left"}">${t(e.trim())}</th>\n`}),a+="</tr>\n</thead>\n"}const i=e.slice(r+1);return i.length>0&&(a+=`<tbody${n("tbody","","|")}>\n`,i.forEach(e=>{a+=`<tr${n("tr","","|")}>\n`;e.replace(/^\|/,"").replace(/\|$/,"").split("|").forEach((e,r)=>{const i=o[r]&&"left"!==o[r]?`text-align:${o[r]}`:"";a+=`<td${n("td",i,"|")} data-qd-align="${o[r]||"left"}">${t(e.trim())}</td>\n`}),a+="</tr>\n"}),a+="</tbody>\n"),a+="</table>",a}return n.toMarkdown=function(e){let t;if("string"==typeof e)t=document.createElement("div"),t.innerHTML=e;else{if(!(e instanceof Element))return"";t=e}function n(e,t={}){if(e.nodeType===Node.TEXT_NODE)return e.textContent;if(e.nodeType!==Node.ELEMENT_NODE)return"";const o=e.tagName.toLowerCase(),a=e.getAttribute("data-qd"),i=window.getComputedStyle?window.getComputedStyle(e):{};let c="";for(let r of e.childNodes)c+=n(r,{parentTag:o,...t});switch(o){case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":const n=parseInt(o[1]);return`${a||"#".repeat(n)} ${c.trim()}\n\n`;case"strong":case"b":if("bold"===i.fontWeight||i.fontWeight>=700||"strong"===o||"b"===o){const e=a||"**";return`${e}${c}${e}`}return c;case"em":case"i":if("italic"===i.fontStyle||"em"===o||"i"===o){const e=a||"*";return`${e}${c}${e}`}return c;case"del":case"s":case"strike":const l=a||"~~";return`${l}${c}${l}`;case"code":if("pre"===t.parentTag)return c;const s=a||"`";return`${s}${c}${s}`;case"pre":const d=e.getAttribute("data-qd-fence")||a||"```",u=e.getAttribute("data-qd-lang")||"",g=e.querySelector("code");return`${d}${u}\n${(g?g.textContent:c).trimEnd()}\n${d}\n\n`;case"blockquote":const p=a||">";return c.trim().split("\n").map(e=>`${p} ${e}`).join("\n")+"\n\n";case"hr":return`${a||"---"}\n\n`;case"br":return`${a||"  "}\n`;case"a":const f=e.getAttribute("data-qd-text")||c.trim(),$=e.getAttribute("href")||"";return f!==$||a?`[${f}](${$})`:`<${$}>`;case"img":return`${a||"!"}[${e.getAttribute("data-qd-alt")||e.getAttribute("alt")||""}](${e.getAttribute("data-qd-src")||e.getAttribute("src")||""})`;case"ul":case"ol":return r(e,"ol"===o)+"\n";case"li":case"span":default:return c;case"table":return function(e){let t="";const n=e.getAttribute("data-qd-align"),r=n?n.split(","):[],o=e.querySelector("thead");if(o){const e=o.querySelector("tr");if(e){const n=[];for(let t of e.querySelectorAll("th"))n.push(t.textContent.trim());t+="| "+n.join(" | ")+" |\n";t+="| "+n.map((e,t)=>{const n=r[t]||th.getAttribute("data-qd-align")||"left";return"center"===n?":---:":"right"===n?"---:":"---"}).join(" | ")+" |\n"}}const a=e.querySelector("tbody");if(a)for(let e of a.querySelectorAll("tr")){const n=[];for(let t of e.querySelectorAll("td"))n.push(t.textContent.trim());n.length>0&&(t+="| "+n.join(" | ")+" |\n")}return t.trim()}(e)+"\n\n";case"p":return c.trim()?c.trim()+"\n\n":"";case"div":if(e.classList&&e.classList.contains("mermaid-container")){const t=e.getAttribute("data-qd-fence")||"```",n=e.getAttribute("data-qd-lang")||"mermaid",r=e.getAttribute("data-qd-source");if(r){const e=document.createElement("textarea");e.innerHTML=r;return`${t}${n}\n${e.value}\n${t}\n\n`}const o=e.querySelector(".mermaid-source");if(o){const e=document.createElement("div");e.innerHTML=o.innerHTML;return`${t}${n}\n${e.textContent}\n${t}\n\n`}const a=e.querySelector(".mermaid");if(a&&a.textContent.includes("graph"))return`${t}${n}\n${a.textContent.trim()}\n${t}\n\n`}if(e.classList&&e.classList.contains("mermaid")){const t=e.getAttribute("data-qd-fence")||"```";return`${t}${e.getAttribute("data-qd-lang")||"mermaid"}\n${e.textContent.trim()}\n${t}\n\n`}return c}}function r(e,t,o=0){let a="",i=1;const c="  ".repeat(o);for(let l of e.children){if("LI"!==l.tagName)continue;let e=l.getAttribute("data-qd")||(t?`${i}.`:"-");const s=l.querySelector('input[type="checkbox"]');if(s){const t=s.checked?"x":" ";e="-";let r="";for(let e of l.childNodes)e.nodeType===Node.TEXT_NODE?r+=e.textContent:e.tagName&&"INPUT"!==e.tagName&&(r+=n(e));a+=`${c}${e} [${t}] ${r.trim()}\n`}else{let t="";for(let e of l.childNodes)"UL"===e.tagName||"OL"===e.tagName?t+=r(e,"OL"===e.tagName,o+1):t+=n(e);a+=`${c}${e} ${t.trim()}\n`}i++}return a}let o=n(t);return o=o.replace(/\n{3,}/g,"\n\n"),o=o.trim(),o},n.emitStyles=function(e="quikdown-",t="light"){return""},n.configure=function(e){return function(t){return n(t,e)}},n.version="1.0.5dev1","undefined"!=typeof module&&module.exports&&(module.exports=n),"undefined"!=typeof window&&(window.quikdown_bd=n),n});
//# sourceMappingURL=quikdown_bd.umd.min.js.map
