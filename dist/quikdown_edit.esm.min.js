/**
 * Quikdown Editor - Drop-in Markdown Parser
 * @version 1.0.5
 * @license BSD-2-Clause
 * @copyright DeftIO 2025
 */
const e="quikdown-",t="§CB",n={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},r={h1:"font-size:2em;font-weight:600;margin:.67em 0;text-align:left",h2:"font-size:1.5em;font-weight:600;margin:.83em 0",h3:"font-size:1.25em;font-weight:600;margin:1em 0",h4:"font-size:1em;font-weight:600;margin:1.33em 0",h5:"font-size:.875em;font-weight:600;margin:1.67em 0",h6:"font-size:.85em;font-weight:600;margin:2em 0",pre:"background:#f4f4f4;padding:10px;border-radius:4px;overflow-x:auto;margin:1em 0",code:"background:#f0f0f0;padding:2px 4px;border-radius:3px;font-family:monospace",blockquote:"border-left:4px solid #ddd;margin-left:0;padding-left:1em",table:"border-collapse:collapse;width:100%;margin:1em 0",th:"border:1px solid #ddd;padding:8px;background-color:#f2f2f2;font-weight:bold;text-align:left",td:"border:1px solid #ddd;padding:8px;text-align:left",hr:"border:none;border-top:1px solid #ddd;margin:1em 0",img:"max-width:100%;height:auto",a:"color:#06c;text-decoration:underline",strong:"font-weight:bold",em:"font-style:italic",del:"text-decoration:line-through",ul:"margin:.5em 0;padding-left:2em",ol:"margin:.5em 0;padding-left:2em",li:"margin:.25em 0","task-item":"list-style:none","task-checkbox":"margin-right:.5em"};function a(a,o={}){if(!a||"string"!=typeof a)return"";const{fence_plugin:s,inline_styles:d=!1,bidirectional:c=!1,lazy_linefeeds:l=!1}=o,u=function(t,n){return function(r,a=""){if(t){let e=n[r];return e||a?(a&&a.includes("text-align")&&e&&e.includes("text-align")&&(e=e.replace(/text-align:[^;]+;?/,"").trim(),e&&!e.endsWith(";")&&(e+=";")),` style="${a?e?`${e}${a}`:a:e}"`):""}{const t=` class="${e}${r}"`;return a?`${t} style="${a}"`:t}}}(d,r);function h(e){return e.replace(/[&<>"']/g,e=>n[e])}const p=c?e=>` data-qd="${h(e)}"`:()=>"";function m(e,t=!1){if(!e)return"";if(t)return e;const n=e.trim(),r=n.toLowerCase(),a=["javascript:","vbscript:","data:"];for(const e of a)if(r.startsWith(e))return"data:"===e&&r.startsWith("data:image/")?n:"#";return n}let g=a;const f=[],b=[];g=g.replace(/^(```|~~~)([^\n]*)\n([\s\S]*?)^\1$/gm,(e,n,r,a)=>{const o=`${t}${f.length}§`,i=r?r.trim():"";return s&&"function"==typeof s?f.push({lang:i,code:a.trimEnd(),custom:!0,fence:n}):f.push({lang:i,code:h(a.trimEnd()),custom:!1,fence:n}),o}),g=g.replace(/`([^`]+)`/g,(e,t)=>{const n=`§IC${b.length}§`;return b.push(h(t)),n}),g=h(g),g=function(e,t){const n=e.split("\n"),r=[];let a=!1,o=[];for(let e=0;e<n.length;e++){const s=n[e].trim();if(s.includes("|")&&(s.startsWith("|")||/[^\\|]/.test(s)))a||(a=!0,o=[]),o.push(s);else{if(a){const e=i(o,t);e?r.push(e):r.push(...o),a=!1,o=[]}r.push(n[e])}}if(a&&o.length>0){const e=i(o,t);e?r.push(e):r.push(...o)}return r.join("\n")}(g,u),g=g.replace(/^(#{1,6})\s+(.+?)\s*#*$/gm,(e,t,n)=>{const r=t.length;return`<h${r}${u("h"+r)}${p(t)}>${n}</h${r}>`}),g=g.replace(/^&gt;\s+(.+)$/gm,`<blockquote${u("blockquote")}>$1</blockquote>`),g=g.replace(/<\/blockquote>\n<blockquote>/g,"\n"),g=g.replace(/^---+$/gm,`<hr${u("hr")}>`),g=function(t,n,r,a){const o=t.split("\n"),i=[];let s=[];const d=e=>e.replace(/[&<>"']/g,e=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[e])),c=a?e=>` data-qd="${d(e)}"`:()=>"";for(let t=0;t<o.length;t++){const a=o[t],d=a.match(/^(\s*)([*\-+]|\d+\.)\s+(.+)$/);if(d){const[,t,a,o]=d,l=Math.floor(t.length/2),u=/^\d+\./.test(a),h=u?"ol":"ul";let p=o,m="";const g=o.match(/^\[([x ])\]\s+(.*)$/i);if(g&&!u){const[,t,n]=g,a="x"===t.toLowerCase();p=`<input type="checkbox"${r?' style="margin-right:.5em"':` class="${e}task-checkbox"`}${a?" checked":""} disabled> ${n}`,m=r?' style="list-style:none"':` class="${e}task-item"`}for(;s.length>l+1;){const e=s.pop();i.push(`</${e.type}>`)}if(s.length===l)s.push({type:h,level:l}),i.push(`<${h}${n(h)}>`);else if(s.length===l+1){const e=s[s.length-1];e.type!==h&&(i.push(`</${e.type}>`),s.pop(),s.push({type:h,level:l}),i.push(`<${h}${n(h)}>`))}const f=m||n("li");i.push(`<li${f}${c(a)}>${p}</li>`)}else{for(;s.length>0;){const e=s.pop();i.push(`</${e.type}>`)}i.push(a)}}for(;s.length>0;){const e=s.pop();i.push(`</${e.type}>`)}return i.join("\n")}(g,u,d,c),g=g.replace(/!\[([^\]]*)\]\(([^)]+)\)/g,(e,t,n)=>{const r=m(n,o.allow_unsafe_urls),a=c&&t?` data-qd-alt="${h(t)}"`:"",i=c?` data-qd-src="${h(n)}"`:"";return`<img${u("img")} src="${r}" alt="${t}"${a}${i}${p("!")}>`}),g=g.replace(/\[([^\]]+)\]\(([^)]+)\)/g,(e,t,n)=>{const r=m(n,o.allow_unsafe_urls),a=/^https?:\/\//i.test(r)?' rel="noopener noreferrer"':"",i=c?` data-qd-text="${h(t)}"`:"";return`<a${u("a")} href="${r}"${a}${i}${p("[")}>${t}</a>`}),g=g.replace(/(^|\s)(https?:\/\/[^\s<]+)/g,(e,t,n)=>{const r=m(n,o.allow_unsafe_urls);return`${t}<a${u("a")} href="${r}" rel="noopener noreferrer">${n}</a>`});if([[/\*\*(.+?)\*\*/g,"strong","**"],[/__(.+?)__/g,"strong","__"],[/(?<!\*)\*(?!\*)(.+?)(?<!\*)\*(?!\*)/g,"em","*"],[/(?<!_)_(?!_)(.+?)(?<!_)_(?!_)/g,"em","_"],[/~~(.+?)~~/g,"del","~~"]].forEach(([e,t,n])=>{g=g.replace(e,`<${t}${u(t)}${p(n)}>$1</${t}>`)}),l){const e=[];let t=0;g=g.replace(/<(table|[uo]l)[^>]*>[\s\S]*?<\/\1>/g,n=>(e[t]=n,`§B${t++}§`)),g=g.replace(/\n\n+/g,"§P§").replace(/(<\/(?:h[1-6]|blockquote|pre)>)\n/g,"$1§N§").replace(/(<(?:h[1-6]|blockquote|pre|hr)[^>]*>)\n/g,"$1§N§").replace(/\n(<(?:h[1-6]|blockquote|pre|hr)[^>]*>)/g,"§N§$1").replace(/\n(§B\d+§)/g,"§N§$1").replace(/(§B\d+§)\n/g,"$1§N§").replace(/\n/g,`<br${u("br")}>`).replace(/§N§/g,"\n").replace(/§P§/g,"</p><p>"),e.forEach((e,t)=>g=g.replace(`§B${t}§`,e)),g="<p>"+g+"</p>"}else g=g.replace(/  $/gm,`<br${u("br")}>`),g=g.replace(/\n\n+/g,"</p><p>"),g="<p>"+g+"</p>";return[[/<p><\/p>/g,""],[/<p>(<h[1-6][^>]*>)/g,"$1"],[/(<\/h[1-6]>)<\/p>/g,"$1"],[/<p>(<blockquote[^>]*>)/g,"$1"],[/(<\/blockquote>)<\/p>/g,"$1"],[/<p>(<ul[^>]*>|<ol[^>]*>)/g,"$1"],[/(<\/ul>|<\/ol>)<\/p>/g,"$1"],[/<p>(<hr[^>]*>)<\/p>/g,"$1"],[/<p>(<table[^>]*>)/g,"$1"],[/(<\/table>)<\/p>/g,"$1"],[/<p>(<pre[^>]*>)/g,"$1"],[/(<\/pre>)<\/p>/g,"$1"],[new RegExp(`<p>(${t}\\d+§)</p>`,"g"),"$1"]].forEach(([e,t])=>{g=g.replace(e,t)}),f.forEach((e,n)=>{let r;if(e.custom&&s){if(r=s(e.code,e.lang),void 0===r){const t=!d&&e.lang?` class="language-${e.lang}"`:"",n=d?u("code"):t,a=c&&e.lang?` data-qd-lang="${h(e.lang)}"`:"",o=c?` data-qd-fence="${h(e.fence)}"`:"";r=`<pre${u("pre")}${o}${a}><code${n}>${h(e.code)}</code></pre>`}}else{const t=!d&&e.lang?` class="language-${e.lang}"`:"",n=d?u("code"):t,a=c&&e.lang?` data-qd-lang="${h(e.lang)}"`:"",o=c?` data-qd-fence="${h(e.fence)}"`:"";r=`<pre${u("pre")}${o}${a}><code${n}>${e.code}</code></pre>`}const a=`${t}${n}§`;g=g.replace(a,r)}),b.forEach((e,t)=>{const n=`§IC${t}§`;g=g.replace(n,`<code${u("code")}${p("`")}>${e}</code>`)}),g.trim()}function o(e,t){return[[/\*\*(.+?)\*\*/g,"strong"],[/__(.+?)__/g,"strong"],[/(?<!\*)\*(?!\*)(.+?)(?<!\*)\*(?!\*)/g,"em"],[/(?<!_)_(?!_)(.+?)(?<!_)_(?!_)/g,"em"],[/~~(.+?)~~/g,"del"],[/`([^`]+)`/g,"code"]].forEach(([n,r])=>{e=e.replace(n,`<${r}${t(r)}>$1</${r}>`)}),e}function i(e,t){if(e.length<2)return null;let n=-1;for(let t=1;t<e.length;t++)if(/^\|?[\s\-:|]+\|?$/.test(e[t])&&e[t].includes("-")){n=t;break}if(-1===n)return null;const r=e.slice(0,n),a=e.slice(n+1),i=e[n].trim().replace(/^\|/,"").replace(/\|$/,"").split("|").map(e=>{const t=e.trim();return t.startsWith(":")&&t.endsWith(":")?"center":t.endsWith(":")?"right":"left"});let s=`<table${t("table")}>\n`;return s+=`<thead${t("thead")}>\n`,r.forEach(e=>{s+=`<tr${t("tr")}>\n`;e.trim().replace(/^\|/,"").replace(/\|$/,"").split("|").forEach((e,n)=>{const r=i[n]&&"left"!==i[n]?`text-align:${i[n]}`:"",a=o(e.trim(),t);s+=`<th${t("th",r)}>${a}</th>\n`}),s+="</tr>\n"}),s+="</thead>\n",a.length>0&&(s+=`<tbody${t("tbody")}>\n`,a.forEach(e=>{s+=`<tr${t("tr")}>\n`;e.trim().replace(/^\|/,"").replace(/\|$/,"").split("|").forEach((e,n)=>{const r=i[n]&&"left"!==i[n]?`text-align:${i[n]}`:"",a=o(e.trim(),t);s+=`<td${t("td",r)}>${a}</td>\n`}),s+="</tr>\n"}),s+="</tbody>\n"),s+="</table>",s}function s(e,t={}){return a(e,{...t,bidirectional:!0})}a.emitStyles=function(e="quikdown-",t="light"){const n=r,a={"#f4f4f4":"#2a2a2a","#f0f0f0":"#2a2a2a","#f2f2f2":"#2a2a2a","#ddd":"#3a3a3a","#06c":"#6db3f2",_textColor:"#e0e0e0"},o={_textColor:"#333"};let i="";for(const[r,s]of Object.entries(n)){let n=s;if("dark"===t&&a){for(const[e,t]of Object.entries(a))e.startsWith("_")||(n=n.replace(new RegExp(e,"g"),t));["h1","h2","h3","h4","h5","h6","td","li","blockquote"].includes(r)&&(n+=`;color:${a._textColor}`)}else if("light"===t&&o){["h1","h2","h3","h4","h5","h6","td","li","blockquote"].includes(r)&&(n+=`;color:${o._textColor}`)}i+=`.${e}${r} { ${n} }\n`}return i},a.configure=function(e){return function(t){return a(t,e)}},a.version="1.0.5","undefined"!=typeof module&&module.exports&&(module.exports=a),"undefined"!=typeof window&&(window.quikdown=a),Object.keys(a).forEach(e=>{s[e]=a[e]}),s.toMarkdown=function(e){let t;if("string"==typeof e)t=document.createElement("div"),t.innerHTML=e;else{if(!(e instanceof Element))return"";t=e}function n(e,t={}){if(e.nodeType===Node.TEXT_NODE)return e.textContent;if(e.nodeType!==Node.ELEMENT_NODE)return"";const a=e.tagName.toLowerCase(),o=e.getAttribute("data-qd");let i="";for(let r of e.childNodes)i+=n(r,{parentTag:a,...t});switch(a){case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":const t=parseInt(a[1]);return`${o||"#".repeat(t)} ${i.trim()}\n\n`;case"strong":case"b":if(!i)return"";const n=o||"**";return`${n}${i}${n}`;case"em":case"i":if(!i)return"";const s=o||"*";return`${s}${i}${s}`;case"del":case"s":case"strike":if(!i)return"";const d=o||"~~";return`${d}${i}${d}`;case"code":if(!i)return"";const c=o||"`";return`${c}${i}${c}`;case"pre":const l=e.getAttribute("data-qd-fence")||o||"```",u=e.getAttribute("data-qd-lang")||"",h=e.querySelector("code");return`${l}${u}\n${(h?h.textContent:i).trimEnd()}\n${l}\n\n`;case"blockquote":const p=o||">";return i.trim().split("\n").map(e=>`${p} ${e}`).join("\n")+"\n\n";case"hr":return`${o||"---"}\n\n`;case"br":return`${o||"  "}\n`;case"a":const m=e.getAttribute("data-qd-text")||i.trim(),g=e.getAttribute("href")||"";return m!==g||o?`[${m}](${g})`:`<${g}>`;case"img":return`${o||"!"}[${e.getAttribute("data-qd-alt")||e.getAttribute("alt")||""}](${e.getAttribute("data-qd-src")||e.getAttribute("src")||""})`;case"ul":case"ol":return r(e,"ol"===a)+"\n";case"li":case"span":default:return i;case"table":return function(e){let t="";const n=e.getAttribute("data-qd-align"),r=n?n.split(","):[],a=e.querySelector("thead");if(a){const e=a.querySelector("tr");if(e){const n=[];for(let t of e.querySelectorAll("th"))n.push(t.textContent.trim());t+="| "+n.join(" | ")+" |\n";t+="| "+n.map((e,t)=>{const n=r[t]||"left";return"center"===n?":---:":"right"===n?"---:":"---"}).join(" | ")+" |\n"}}const o=e.querySelector("tbody");if(o)for(let e of o.querySelectorAll("tr")){const n=[];for(let t of e.querySelectorAll("td"))n.push(t.textContent.trim());n.length>0&&(t+="| "+n.join(" | ")+" |\n")}return t.trim()}(e)+"\n\n";case"p":return i.trim()?i.trim()+"\n\n":"";case"div":if(e.classList&&e.classList.contains("mermaid-container")){const t=e.getAttribute("data-qd-fence")||"```",n=e.getAttribute("data-qd-lang")||"mermaid",r=e.getAttribute("data-qd-source");if(r){const e=document.createElement("textarea");e.innerHTML=r;return`${t}${n}\n${e.value}\n${t}\n\n`}const a=e.querySelector("pre.mermaid");if(a){const e=a.getAttribute("data-qd-source");if(e){const r=document.createElement("textarea");r.innerHTML=e;return`${t}${n}\n${r.value}\n${t}\n\n`}}const o=e.querySelector(".mermaid-source");if(o){const e=document.createElement("div");e.innerHTML=o.innerHTML;return`${t}${n}\n${e.textContent}\n${t}\n\n`}const i=e.querySelector(".mermaid");if(i&&i.textContent.includes("graph"))return`${t}${n}\n${i.textContent.trim()}\n${t}\n\n`}if(e.classList&&e.classList.contains("mermaid")){const t=e.getAttribute("data-qd-fence")||"```";return`${t}${e.getAttribute("data-qd-lang")||"mermaid"}\n${e.textContent.trim()}\n${t}\n\n`}return i}}function r(e,t,a=0){let o="",i=1;const s="  ".repeat(a);for(let d of e.children){if("LI"!==d.tagName)continue;let e=d.getAttribute("data-qd")||(t?`${i}.`:"-");const c=d.querySelector('input[type="checkbox"]');if(c){const t=c.checked?"x":" ";e="-";let r="";for(let e of d.childNodes)e.nodeType===Node.TEXT_NODE?r+=e.textContent:e.tagName&&"INPUT"!==e.tagName&&(r+=n(e));o+=`${s}${e} [${t}] ${r.trim()}\n`}else{let t="";for(let e of d.childNodes)"UL"===e.tagName||"OL"===e.tagName?t+=r(e,"OL"===e.tagName,a+1):t+=n(e);o+=`${s}${e} ${t.trim()}\n`}i++}return o}let a=n(t);return a=a.replace(/\n{3,}/g,"\n\n"),a=a.trim(),a},s.configure=function(e){return function(t){return s(t,e)}},"undefined"!=typeof module&&module.exports&&(module.exports=s),"undefined"!=typeof window&&(window.quikdown_bd=s);
/**
 * Quikdown Editor - A drop-in markdown editor control
 * @version 1.0.5
 * @license BSD-2-Clause
 */
const d={mode:"split",showToolbar:!0,theme:"auto",lazy_linefeeds:!1,debounceDelay:100,placeholder:"Start typing markdown...",plugins:{highlightjs:!1,mermaid:!1},customFences:{},enableComplexFences:!0};class c{constructor(e,t={}){if(this.container="string"==typeof e?document.querySelector(e):e,!this.container)throw new Error("QuikdownEditor: Invalid container");this.options={...d,...t},this._markdown="",this._html="",this.currentMode=this.options.mode,this.updateTimer=null,this.initPromise=this.init()}async init(){await this.loadPlugins(),this.buildUI(),this.attachEvents(),this.applyTheme(),this.setMode(this.currentMode),this.options.initialContent&&this.setMarkdown(this.options.initialContent)}buildUI(){this.container.innerHTML="",this.container.classList.add("qde-container"),this.options.showToolbar&&(this.toolbar=this.createToolbar(),this.container.appendChild(this.toolbar)),this.editorArea=document.createElement("div"),this.editorArea.className="qde-editor",this.sourcePanel=document.createElement("div"),this.sourcePanel.className="qde-source",this.sourceTextarea=document.createElement("textarea"),this.sourceTextarea.className="qde-textarea",this.sourceTextarea.placeholder=this.options.placeholder,this.sourcePanel.appendChild(this.sourceTextarea),this.previewPanel=document.createElement("div"),this.previewPanel.className="qde-preview",this.previewPanel.contentEditable=!0,this.editorArea.appendChild(this.sourcePanel),this.editorArea.appendChild(this.previewPanel),this.container.appendChild(this.editorArea),this.injectStyles()}createToolbar(){const e=document.createElement("div");e.className="qde-toolbar";const t={source:"Source",split:"Split",preview:"Rendered"};["source","split","preview"].forEach(n=>{const r=document.createElement("button");r.className="qde-btn",r.dataset.mode=n,r.textContent=t[n],r.title=`Switch to ${t[n]} view`,e.appendChild(r)});const n=document.createElement("span");n.className="qde-spacer",e.appendChild(n);return[{action:"copy-markdown",text:"Copy MD",title:"Copy markdown to clipboard"},{action:"copy-html",text:"Copy HTML",title:"Copy HTML to clipboard"}].forEach(({action:t,text:n,title:r})=>{const a=document.createElement("button");a.className="qde-btn",a.dataset.action=t,a.textContent=n,a.title=r,e.appendChild(a)}),e}injectStyles(){if(document.getElementById("qde-styles"))return;const e=document.createElement("style");e.id="qde-styles",e.textContent='\n            .qde-container {\n                display: flex;\n                flex-direction: column;\n                height: 100%;\n                border: 1px solid #ddd;\n                border-radius: 4px;\n                overflow: hidden;\n                background: white;\n            }\n            \n            .qde-toolbar {\n                display: flex;\n                align-items: center;\n                padding: 8px;\n                background: #f5f5f5;\n                border-bottom: 1px solid #ddd;\n                gap: 4px;\n            }\n            \n            .qde-btn {\n                padding: 6px 12px;\n                border: 1px solid #ccc;\n                background: white;\n                border-radius: 3px;\n                cursor: pointer;\n                font-size: 14px;\n                transition: all 0.2s;\n            }\n            \n            .qde-btn:hover {\n                background: #e9e9e9;\n                border-color: #999;\n            }\n            \n            .qde-btn.active {\n                background: #007bff;\n                color: white;\n                border-color: #0056b3;\n            }\n            \n            .qde-spacer {\n                flex: 1;\n            }\n            \n            .qde-editor {\n                display: flex;\n                flex: 1;\n                overflow: hidden;\n            }\n            \n            .qde-source, .qde-preview {\n                flex: 1;\n                overflow: auto;\n                padding: 16px;\n            }\n            \n            .qde-source {\n                border-right: 1px solid #ddd;\n            }\n            \n            .qde-textarea {\n                width: 100%;\n                height: 100%;\n                border: none;\n                outline: none;\n                resize: none;\n                font-family: \'Monaco\', \'Courier New\', monospace;\n                font-size: 14px;\n                line-height: 1.5;\n            }\n            \n            .qde-preview {\n                font-family: -apple-system, BlinkMacSystemFont, \'Segoe UI\', Roboto, sans-serif;\n                font-size: 16px;\n                line-height: 1.6;\n                outline: none;\n                cursor: text;  /* Standard text cursor */\n            }\n            \n            /* Fence-specific styles */\n            .qde-svg-container {\n                max-width: 100%;\n                overflow: auto;\n            }\n            \n            .qde-svg-container svg {\n                max-width: 100%;\n                height: auto;\n            }\n            \n            .qde-html-container {\n                /* HTML containers inherit background */\n                margin: 12px 0;\n            }\n            \n            .qde-math-container {\n                text-align: center;\n                margin: 16px 0;\n                overflow-x: auto;\n            }\n            \n            /* All tables in preview (both regular markdown and CSV) */\n            .qde-preview table {\n                width: 100%;\n                border-collapse: collapse;\n                margin: 12px 0;\n                font-size: 14px;\n            }\n            \n            .qde-preview table th,\n            .qde-preview table td {\n                border: 1px solid #ddd;\n                padding: 8px;\n            }\n            \n            /* Support for alignment classes from quikdown */\n            .qde-preview .quikdown-left { text-align: left; }\n            .qde-preview .quikdown-center { text-align: center; }\n            .qde-preview .quikdown-right { text-align: right; }\n            \n            .qde-preview table th {\n                background: #f5f5f5;\n                font-weight: bold;\n            }\n            \n            .qde-preview table tr:nth-child(even) {\n                background: #f9f9f9;\n            }\n            \n            /* Specific to CSV-generated tables */\n            .qde-data-table {\n                /* Can add specific CSV table styles here if needed */\n            }\n            \n            .qde-json {\n                /* Let highlight.js handle styling */\n                overflow-x: auto;\n            }\n            \n            .qde-error {\n                background: #fee;\n                border: 1px solid #fcc;\n                color: #c00;\n                padding: 8px;\n                border-radius: 4px;\n                font-family: monospace;\n                font-size: 12px;\n            }\n            \n            /* Read-only complex fence blocks in preview */\n            .qde-preview [contenteditable="false"] {\n                cursor: auto;  /* Use automatic cursor (arrow for non-text) */\n                user-select: text;\n                position: relative;\n            }\n            \n            /* Ensure proper cursor for editable text elements */\n            .qde-preview p,\n            .qde-preview h1,\n            .qde-preview h2,\n            .qde-preview h3,\n            .qde-preview h4,\n            .qde-preview h5,\n            .qde-preview h6,\n            .qde-preview li,\n            .qde-preview td,\n            .qde-preview th,\n            .qde-preview blockquote,\n            .qde-preview pre[contenteditable="true"],\n            .qde-preview code[contenteditable="true"] {\n                cursor: text;\n            }\n            \n            \n            /* Non-editable complex renderers */\n            .qde-preview .qde-svg-container[contenteditable="false"],\n            .qde-preview .qde-html-container[contenteditable="false"],\n            .qde-preview .qde-math-container[contenteditable="false"],\n            .qde-preview .mermaid[contenteditable="false"] {\n                opacity: 0.98;\n            }\n            \n            /* Subtle hover effect for read-only blocks */\n            .qde-preview [contenteditable="false"]:hover::after {\n                content: "Read-only";\n                position: absolute;\n                top: 2px;\n                right: 2px;\n                font-size: 10px;\n                color: #999;\n                background: rgba(255, 255, 255, 0.9);\n                padding: 2px 4px;\n                border-radius: 2px;\n                pointer-events: none;\n            }\n            \n            /* Fix list padding in preview */\n            .qde-preview ul,\n            .qde-preview ol {\n                padding-left: 2em;\n                margin: 0.5em 0;\n            }\n            \n            .qde-preview li {\n                margin: 0.25em 0;\n            }\n            \n            /* Mode-specific visibility */\n            .qde-mode-source .qde-preview { display: none; }\n            .qde-mode-source .qde-source { border-right: none; }\n            .qde-mode-preview .qde-source { display: none; }\n            .qde-mode-split .qde-source,\n            .qde-mode-split .qde-preview { display: block; }\n            \n            /* Dark theme */\n            .qde-dark {\n                background: #1e1e1e;\n                color: #e0e0e0;\n            }\n            \n            .qde-dark .qde-toolbar {\n                background: #2d2d2d;\n                border-color: #444;\n            }\n            \n            .qde-dark .qde-btn {\n                background: #3a3a3a;\n                color: #e0e0e0;\n                border-color: #555;\n            }\n            \n            .qde-dark .qde-btn:hover {\n                background: #4a4a4a;\n            }\n            \n            .qde-dark .qde-source {\n                border-color: #444;\n            }\n            \n            .qde-dark .qde-textarea {\n                background: #1e1e1e;\n                color: #e0e0e0;\n            }\n            \n            .qde-dark .qde-preview {\n                background: #1e1e1e;\n                color: #e0e0e0;\n            }\n            \n            /* Dark mode table styles */\n            .qde-dark .qde-preview table th,\n            .qde-dark .qde-preview table td {\n                border-color: #3a3a3a;\n            }\n            \n            .qde-dark .qde-preview table th {\n                background: #2d2d2d;\n            }\n            \n            .qde-dark .qde-preview table tr:nth-child(even) {\n                background: #252525;\n            }\n            \n            /* Mobile responsive */\n            @media (max-width: 768px) {\n                .qde-mode-split .qde-editor {\n                    flex-direction: column;\n                }\n                \n                .qde-mode-split .qde-source {\n                    border-right: none;\n                    border-bottom: 1px solid #ddd;\n                }\n            }\n        ',document.head.appendChild(e)}attachEvents(){this.sourceTextarea.addEventListener("input",()=>{this.handleSourceInput()}),this.previewPanel.addEventListener("input",()=>{this.handlePreviewInput()}),this.toolbar&&this.toolbar.addEventListener("click",e=>{const t=e.target.closest(".qde-btn");t&&(t.dataset.mode?this.setMode(t.dataset.mode):t.dataset.action&&this.handleAction(t.dataset.action))}),document.addEventListener("keydown",e=>{if(e.ctrlKey||e.metaKey)switch(e.key){case"1":e.preventDefault(),this.setMode("source");break;case"2":e.preventDefault(),this.setMode("split");break;case"3":e.preventDefault(),this.setMode("preview")}})}handleSourceInput(){clearTimeout(this.updateTimer),this.updateTimer=setTimeout(()=>{this.updateFromMarkdown(this.sourceTextarea.value)},this.options.debounceDelay)}handlePreviewInput(){clearTimeout(this.updateTimer),this.updateTimer=setTimeout(()=>{this.updateFromHTML()},this.options.debounceDelay)}updateFromMarkdown(e){this._markdown=e||"",this._markdown.trim()?(this._html=s(e,{fence_plugin:this.createFencePlugin(),lazy_linefeeds:this.options.lazy_linefeeds}),"source"!==this.currentMode&&(this.previewPanel.innerHTML=this._html,this.makeFencesNonEditable())):(this._html="","source"!==this.currentMode&&(this.previewPanel.innerHTML='<div style="color: #999; font-style: italic; padding: 16px;">Start typing markdown in the source panel...</div>')),this.options.onChange&&this.options.onChange(this._markdown,this._html)}updateFromHTML(){const e=this.previewPanel.cloneNode(!0);this.preprocessSpecialElements(e),this._html=this.previewPanel.innerHTML,this._markdown=s.toMarkdown(e),"preview"!==this.currentMode&&(this.sourceTextarea.value=this._markdown),this.options.onChange&&this.options.onChange(this._markdown,this._html)}preprocessSpecialElements(e){if(!e)return;e.querySelectorAll('[contenteditable="false"][data-qd-source]').forEach(e=>{const t=e.getAttribute("data-qd-source"),n=e.getAttribute("data-qd-fence")||"```",r=e.getAttribute("data-qd-lang")||"",a=document.createElement("pre");a.setAttribute("data-qd-fence",n),r&&a.setAttribute("data-qd-lang",r);const o=document.createElement("code");o.textContent=t,a.appendChild(o),e.parentNode.replaceChild(a,e)});e.querySelectorAll("table.qde-csv-table[data-qd-lang]").forEach(e=>{const t=e.getAttribute("data-qd-lang");if(!t||!["csv","psv","tsv"].includes(t))return;const n="csv"===t?",":"psv"===t?"|":"\t";let r="";const a=[];e.querySelectorAll("thead th").forEach(e=>{const t=e.textContent.trim(),r=t.includes(n)||t.includes('"')||t.includes("\n");a.push(r?`"${t.replace(/"/g,'""')}"`:t)}),r+=a.join(n)+"\n";e.querySelectorAll("tbody tr").forEach(e=>{const t=[];e.querySelectorAll("td").forEach(e=>{const r=e.textContent.trim(),a=r.includes(n)||r.includes('"')||r.includes("\n");t.push(a?`"${r.replace(/"/g,'""')}"`:r)}),r+=t.join(n)+"\n"});const o=document.createElement("pre");o.setAttribute("data-qd-fence","```"),o.setAttribute("data-qd-lang",t);const i=document.createElement("code");i.textContent=r.trim(),o.appendChild(i),e.parentNode.replaceChild(o,e)})}createFencePlugin(){return(e,t)=>{if(this.options.customFences&&this.options.customFences[t])try{return this.options.customFences[t](e,t)}catch(n){return console.error(`Custom fence plugin error for ${t}:`,n),`<pre><code class="language-${t}">${this.escapeHtml(e)}</code></pre>`}if(!!this.options.enableComplexFences)switch(t){case"svg":return this.renderSVG(e);case"html":return this.renderHTML(e);case"math":case"katex":case"tex":case"latex":return this.renderMath(e,t);case"csv":case"psv":case"tsv":return this.renderTable(e,t);case"json":case"json5":return this.renderJSON(e,t);case"mermaid":if(window.mermaid)return this.renderMermaid(e)}if(window.hljs&&t&&hljs.getLanguage(t)){return`<pre data-qd-fence="\`\`\`" data-qd-lang="${t}"><code class="hljs language-${t}">${hljs.highlight(e,{language:t}).value}</code></pre>`}}}renderSVG(e){try{const t=(new DOMParser).parseFromString(e,"image/svg+xml");if(t.querySelector("parsererror"))throw new Error("Invalid SVG");const n=t.documentElement;n.querySelectorAll("script").forEach(e=>e.remove());const r=document.createTreeWalker(n,NodeFilter.SHOW_ELEMENT);let a;for(;a=r.nextNode();)for(let e=a.attributes.length-1;e>=0;e--){const t=a.attributes[e];(t.name.startsWith("on")||t.value.includes("javascript:"))&&a.removeAttribute(t.name)}const o=document.createElement("div");return o.className="qde-svg-container",o.contentEditable="false",o.setAttribute("data-qd-fence","```"),o.setAttribute("data-qd-lang","svg"),o.setAttribute("data-qd-source",e),o.innerHTML=(new XMLSerializer).serializeToString(n),o.outerHTML}catch(e){const t=document.createElement("pre");return t.className="qde-error",t.contentEditable="false",t.setAttribute("data-qd-fence","```"),t.setAttribute("data-qd-lang","svg"),t.textContent=`Invalid SVG: ${e.message}`,t.outerHTML}}renderHTML(e){const t=`html-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;if(window.DOMPurify){const t=DOMPurify.sanitize(e),n=document.createElement("div");return n.className="qde-html-container",n.contentEditable="false",n.setAttribute("data-qd-fence","```"),n.setAttribute("data-qd-lang","html"),n.setAttribute("data-qd-source",e),n.innerHTML=t,n.outerHTML}this.lazyLoadLibrary("DOMPurify",()=>window.DOMPurify,"https://unpkg.com/dompurify/dist/purify.min.js").then(n=>{if(n){const n=document.getElementById(t);if(n){const t=DOMPurify.sanitize(e);n.innerHTML=t,n.setAttribute("data-qd-source",e),n.setAttribute("data-qd-fence","```"),n.setAttribute("data-qd-lang","html")}}});const n=document.createElement("div");n.id=t,n.className="qde-html-container",n.contentEditable="false",n.setAttribute("data-qd-fence","```"),n.setAttribute("data-qd-lang","html"),n.setAttribute("data-qd-source",e);const r=document.createElement("pre");return r.textContent=e,n.appendChild(r),n.outerHTML}renderMath(e,t){const n=`math-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;if(window.katex)try{const n=katex.renderToString(e,{displayMode:!0,throwOnError:!1}),r=document.createElement("div");return r.className="qde-math-container",r.contentEditable="false",r.setAttribute("data-qd-fence","```"),r.setAttribute("data-qd-lang",t),r.setAttribute("data-qd-source",e),r.innerHTML=n,r.outerHTML}catch(n){const r=document.createElement("pre");return r.className="qde-error",r.contentEditable="false",r.setAttribute("data-qd-fence","```"),r.setAttribute("data-qd-lang",t),r.setAttribute("data-qd-source",e),r.textContent=`Math error: ${n.message}`,r.outerHTML}this.lazyLoadLibrary("KaTeX",()=>window.katex,"https://unpkg.com/katex/dist/katex.min.js","https://unpkg.com/katex/dist/katex.min.css").then(r=>{if(r){const r=document.getElementById(n);if(r)try{katex.render(e,r,{displayMode:!0,throwOnError:!1}),r.setAttribute("data-qd-source",e),r.setAttribute("data-qd-fence","```"),r.setAttribute("data-qd-lang",t)}catch(e){r.innerHTML=`<pre class="qde-error">Math error: ${this.escapeHtml(e.message)}</pre>`}}});const r=document.createElement("div");r.id=n,r.className="qde-math-container",r.contentEditable="false",r.setAttribute("data-qd-fence","```"),r.setAttribute("data-qd-lang",t),r.setAttribute("data-qd-source",e);const a=document.createElement("pre");return a.textContent=e,r.appendChild(a),r.outerHTML}renderTable(e,t){const n=this.escapeHtml(e);try{const r="csv"===t?",":"psv"===t?"|":"\t",a=e.trim().split("\n");if(0===a.length)return`<pre data-qd-fence="\`\`\`" data-qd-lang="${t}" data-qd-source="${n}">${n}</pre>`;let o=`<table class="qde-data-table qde-csv-table" data-qd-fence="\`\`\`" data-qd-lang="${t}">`;const i=this.parseCSVLine(a[0],r);if(o+="<thead><tr>",i.forEach(e=>{o+=`<th>${this.escapeHtml(e.trim())}</th>`}),o+="</tr></thead>",a.length>1){o+="<tbody>";for(let e=1;e<a.length;e++){const t=this.parseCSVLine(a[e],r);o+="<tr>",t.forEach(e=>{o+=`<td>${this.escapeHtml(e.trim())}</td>`}),o+="</tr>"}o+="</tbody>"}return o+="</table>",o}catch(e){return`<pre data-qd-fence="\`\`\`" data-qd-lang="${t}" data-qd-source="${n}">${n}</pre>`}}parseCSVLine(e,t){const n=[];let r="",a=!1;for(let o=0;o<e.length;o++){const i=e[o],s=e[o+1];'"'===i?a&&'"'===s?(r+='"',o++):a=!a:i!==t||a?r+=i:(n.push(r),r="")}return n.push(r),n}renderJSON(e,t){if(window.hljs&&hljs.getLanguage("json"))try{let n=e;try{const t=JSON.parse(e);n=JSON.stringify(t,null,2)}catch(e){}return`<pre class="qde-json" data-qd-fence="\`\`\`" data-qd-lang="${t}"><code class="hljs language-json">${hljs.highlight(n,{language:"json"}).value}</code></pre>`}catch(e){}return`<pre class="qde-json" data-qd-fence="\`\`\`" data-qd-lang="${t}">${this.escapeHtml(e)}</pre>`}renderMermaid(e){const t=`mermaid-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;setTimeout(()=>{const n=document.getElementById(t);n&&window.mermaid&&mermaid.render(t+"-svg",e).then(e=>{n.innerHTML=e.svg}).catch(e=>{n.innerHTML=`<pre>Error rendering diagram: ${e.message}</pre>`})},0);const n=document.createElement("div");return n.id=t,n.className="mermaid",n.contentEditable="false",n.setAttribute("data-qd-source",e),n.setAttribute("data-qd-fence","```"),n.setAttribute("data-qd-lang","mermaid"),n.textContent="Loading diagram...",n.outerHTML}escapeHtml(e){return(e??"").replace(/[&"'<>]/g,e=>({"&":"&amp;",'"':"&quot;","'":"&#39;","<":"&lt;",">":"&gt;"}[e]))}makeFencesNonEditable(){this.previewPanel}async loadPlugins(){const e=[];this.options.plugins.highlightjs&&!window.hljs&&e.push(this.loadScript("https://unpkg.com/@highlightjs/cdn-assets/highlight.min.js"),this.loadCSS("https://unpkg.com/@highlightjs/cdn-assets/styles/github.min.css")),this.options.plugins.mermaid&&!window.mermaid&&e.push(this.loadScript("https://unpkg.com/mermaid/dist/mermaid.min.js").then(()=>{window.mermaid&&mermaid.initialize({startOnLoad:!1})})),await Promise.all(e)}async lazyLoadLibrary(e,t,n,r=null){if(t())return!0;try{const e=[];return n&&e.push(this.loadScript(n)),r&&e.push(this.loadCSS(r)),await Promise.all(e),t()}catch(t){return console.error(`Failed to load ${e}:`,t),!1}}loadScript(e){return new Promise((t,n)=>{const r=document.createElement("script");r.src=e,r.onload=t,r.onerror=n,document.head.appendChild(r)})}loadCSS(e){return new Promise(t=>{const n=document.createElement("link");n.rel="stylesheet",n.href=e,n.onload=t,document.head.appendChild(n),setTimeout(t,1e3)})}applyTheme(){const e=this.options.theme;if("auto"===e){const e=window.matchMedia("(prefers-color-scheme: dark)").matches;this.container.classList.toggle("qde-dark",e),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{this.container.classList.toggle("qde-dark",e.matches)})}else this.container.classList.toggle("qde-dark","dark"===e)}setLazyLinefeeds(e){this.options.lazy_linefeeds=e,this._markdown&&this.updateFromSource()}getLazyLinefeeds(){return this.options.lazy_linefeeds}setMode(e){["source","preview","split"].includes(e)&&(this.currentMode=e,this.container.className=`qde-container qde-mode-${e}`,this.toolbar&&this.toolbar.querySelectorAll(".qde-btn[data-mode]").forEach(t=>{t.classList.toggle("active",t.dataset.mode===e)}),this.container.classList.contains("qde-dark")&&this.container.classList.add("qde-dark"),"source"!==e&&setTimeout(()=>this.makeFencesNonEditable(),0),this.options.onModeChange&&this.options.onModeChange(e))}handleAction(e){switch(e){case"copy-markdown":this.copy("markdown");break;case"copy-html":this.copy("html")}}async copy(e){const t="markdown"===e?this._markdown:this._html;try{await navigator.clipboard.writeText(t);const n=this.toolbar.querySelector(`[data-action="copy-${e}"]`);if(n){const e=n.textContent;n.textContent="Copied!",setTimeout(()=>{n.textContent=e},1500)}}catch(e){console.error("Failed to copy:",e)}}get markdown(){return this._markdown}set markdown(e){this.setMarkdown(e)}get html(){return this._html}get mode(){return this.currentMode}async setMarkdown(e){this.initPromise&&await this.initPromise,this._markdown=e,this.sourceTextarea&&(this.sourceTextarea.value=e),this.updateFromMarkdown(e)}getMarkdown(){return this._markdown}getHTML(){return this._html}destroy(){clearTimeout(this.updateTimer),this.container.innerHTML="",this.container.classList.remove("qde-container","qde-dark");if(0===document.querySelectorAll(".qde-container").length){const e=document.getElementById("qde-styles");e&&e.remove()}}}"undefined"!=typeof window&&(window.QuikdownEditor=c);export{c as default};
//# sourceMappingURL=quikdown_edit.esm.min.js.map
