<!DOCTYPE html>
<html>
<head>
    <title>Debug Fence Issue</title>
    <script src="../../dist/quikdown.umd.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
</head>
<body>
    <h1>Debug ~~~ Fence Issue</h1>
    
    <div style="display: flex; gap: 20px;">
        <div style="flex: 1;">
            <h2>Input</h2>
            <textarea id="input" style="width: 100%; height: 300px; font-family: monospace;">
## Test with ~~~

~~~python
def parse_markdown(text):
    """Parse markdown with quikdown"""
    return quikdown(text)
~~~

## Test with ```

```python
def parse_markdown(text):
    """Parse markdown with quikdown"""
    return quikdown(text)
```
</textarea>
        </div>
        
        <div style="flex: 1;">
            <h2>Output (with plugin)</h2>
            <div id="output" style="border: 1px solid #ddd; padding: 10px; min-height: 300px;"></div>
        </div>
        
        <div style="flex: 1;">
            <h2>Raw HTML</h2>
            <pre id="raw" style="background: #f0f0f0; padding: 10px; min-height: 300px; font-size: 12px; overflow: auto;"></pre>
        </div>
    </div>
    
    <div style="margin-top: 20px;">
        <label>
            <input type="checkbox" id="enable-plugin" checked> Enable Highlight.js Plugin
        </label>
        <button onclick="render()">Render</button>
    </div>
    
    <div id="console" style="margin-top: 20px; padding: 10px; background: #f0f0f0; font-family: monospace; font-size: 12px;"></div>
    
    <script>
        const consoleLog = [];
        
        function log(msg) {
            consoleLog.push(msg);
            document.getElementById('console').innerHTML = consoleLog.join('<br>');
        }
        
        function render() {
            consoleLog.length = 0;
            const input = document.getElementById('input').value;
            const enablePlugin = document.getElementById('enable-plugin').checked;
            
            let html;
            if (enablePlugin) {
                html = quikdown(input, {
                    fence_plugin: (code, language) => {
                        log(`fence_plugin called: lang="${language}", code="${code.substring(0, 50)}..."`);
                        
                        if (language && hljs.getLanguage(language)) {
                            try {
                                const highlighted = hljs.highlight(code, { language }).value;
                                log(`  ✓ Highlighted as ${language}`);
                                return `<pre class="hljs"><code class="language-${language}">${highlighted}</code></pre>`;
                            } catch (err) {
                                log(`  ✗ Error: ${err.message}`);
                            }
                        }
                        log(`  → Using default rendering`);
                        return undefined;
                    }
                });
            } else {
                html = quikdown(input);
                log('Rendered without plugin');
            }
            
            document.getElementById('output').innerHTML = html;
            document.getElementById('raw').textContent = html;
            
            // Check for language classes
            const pythonBlocks = (html.match(/language-python/g) || []).length;
            log(`\nFound ${pythonBlocks} Python code blocks`);
        }
        
        // Initial render
        render();
    </script>
</body>
</html>