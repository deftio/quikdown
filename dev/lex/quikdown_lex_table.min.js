const t={rules:{0:{t:"repetition",r:"block"},1:{t:"choice",r:["heading","fence","hr","blockquote","list","table","paragraph","blank_line"]},2:{t:"sequence",r:[{t:"terminal",p:0}]},3:{t:"sequence",r:[{t:"terminal",p:1,c:"level"},{t:"terminal",p:2},{t:"until",p:3,c:"content",pr:"inline"},{t:"terminal",p:4,o:!0},{t:"terminal",p:5}],e:"heading"},4:{t:"sequence",r:[{t:"terminal",p:6,c:"marker"},{t:"until",p:3,c:"lang"},{t:"terminal",p:7},{t:"until_fence",c:"content"},{t:"backreference",ref:"marker"},{t:"terminal",p:8}],e:"fence"},5:{t:"sequence",r:[{t:"terminal",p:9},{t:"terminal",p:5}],e:"hr"},6:{t:"sequence",r:[{t:"terminal",p:10},{t:"until",p:3,c:"content",pr:"inline"},{t:"terminal",p:5}],e:"blockquote"},7:{t:"choice",r:["ordered_list","unordered_list"]},8:{t:"sequence",r:[{t:"terminal",p:11,c:"marker"},{t:"list_items",o:!0}],e:"ol"},9:{t:"sequence",r:[{t:"terminal",p:12,c:"marker"},{t:"list_items",o:!1}],e:"ul"},10:{t:"sequence",r:[{t:"table_row",c:"header"},{t:"terminal",p:13},{t:"terminal",p:7},{t:"table_rows",c:"rows"}],e:"table"},11:{t:"sequence",r:[{t:"paragraph_lines",c:"content",pr:"inline"}],e:"p"},12:{t:"repetition",r:"inline_element"},13:{t:"choice",r:["escape","strong","emphasis","strikethrough","code","image","link","text"]},14:{t:"sequence",r:[{t:"terminal",p:14},{t:"terminal",p:15,c:"char"}],e:"escape"},15:{t:"choice",r:[{t:"sequence",r:[{t:"terminal",p:16},{t:"until",p:17,c:"content",pr:"inline"},{t:"terminal",p:16}]},{t:"sequence",r:[{t:"terminal",p:18},{t:"until",p:19,c:"content",pr:"inline"},{t:"terminal",p:18}]}],e:"strong"},16:{t:"choice",r:[{t:"sequence",r:[{t:"terminal",p:20},{t:"until",p:21,c:"content",pr:"inline"},{t:"terminal",p:22}]},{t:"sequence",r:[{t:"terminal",p:23},{t:"until",p:24,c:"content",pr:"inline"},{t:"terminal",p:25}]}],e:"em"},17:{t:"sequence",r:[{t:"terminal",p:26},{t:"until",p:27,c:"content",pr:"inline"},{t:"terminal",p:26}],e:"del"},18:{t:"sequence",r:[{t:"terminal",p:28},{t:"until",p:29,c:"content"},{t:"terminal",p:28}],e:"code"},19:{t:"sequence",r:[{t:"terminal",p:30},{t:"balanced_brackets",c:"alt"},{t:"terminal",p:31},{t:"until",p:32,c:"url"},{t:"terminal",p:33}],e:"img"},20:{t:"sequence",r:[{t:"terminal",p:34},{t:"balanced_brackets",c:"text",pr:"inline"},{t:"terminal",p:31},{t:"until",p:32,c:"url"},{t:"terminal",p:33}],e:"a"},21:{t:"terminal",p:35,c:"content",e:"text"}},charMap:{"*":[2,8,9,15,16,21],"+":[2,8,9,15,16],"-":[2,5,8,9,15,16],"#":[3],"`":[4,18,21],">":[6],"~":[17],"!":[19],"^":[21],"\\":[21,21],i:[21],"[":[21]},templates:{heading:"<h{level}{attr}>{content}</h{level}>",fence:"<pre{attr}><code{lang}>{content}</code></pre>",hr:"<hr{attr}>",blockquote:"<blockquote{attr}>{content}</blockquote>",ol:"<ol{attr}>{items}</ol>",ul:"<ul{attr}>{items}</ul>",table:"<table{attr}>\n<thead{attr}>\n<tr{attr}>\n{header}</tr>\n</thead>\n{body}</table>",p:"<p{attr}>{content}</p>",escape:"{char}",strong:"<strong{attr}>{content}</strong>",em:"<em{attr}>{content}</em>",del:"<del{attr}>{content}</del>",code:"<code{attr}>{content}</code>",img:'<img{attr} src="{url}" alt="{alt}">',a:'<a{attr} href="{url}"{rel}>{text}</a>',text:"{content}"},patterns:[/^\n+/,/^(#{1,6})(?= )/,/^ +/,/\n|$/,/\s*#+\s*$/,/\n?/,/^(```|~~~)/,/\n/,/[^\n]*\n?/,/^---+\s*$/,/^> ?/,/^\d+\. /,/^[*+-] /,/^[\s\|:\-]+$/,/^\\/,/^./,/^\*\*/,/\*\*/,/^__/,/__/,/^\*(?!\*)/,/\*/,/^\*/,/^_(?!_)/,/_/,/^_/,/^~~/,/~~/,/^`/,/`/,/^!\[/,/^\(/,/\)/,/^\)/,/^\[/,/^[^\\`*_\[\]!~\n<]+|^./].map(t=>"string"==typeof t&&t.startsWith("/")?RegExp(t.slice(1,t.lastIndexOf("/")),t.slice(t.lastIndexOf("/")+1)):t)},e=t=>{const e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};let n="";for(let i=0;t.length>i;i++)n+=e[t[i]]||t[i];return n};class n{constructor(t={}){this.opts={inline_styles:t.inline_styles||!1,class_prefix:t.class_prefix||"quikdown-",fence_plugin:t.fence_plugin||null,lazy_linefeeds:t.lazy_linefeeds||!1,allow_unsafe_urls:t.allow_unsafe_urls||!1}}parse(t){if(!t)return"";this.input=t,this.pos=0,this.captures={};const e=[];for(;this.input.length>this.pos;){if(this.match(/^\n+/))continue;const t=this.parseBlock();t&&e.push(t)}return this.processBlocks(e)}parseBlock(){const e=t.charMap[this.input[this.pos]];if(e)for(const n of e){const e=this.execRule(t.rules[n]);if(null!==e)return e}for(const e of[2,3,4,5,6,7,8]){const n=this.pos,i=this.execRule(t.rules[e]);if(null!==i)return i;this.pos=n}return this.execRule(t.rules[8])}execRule(e){if(!e)return null;switch(e.t){case"terminal":const n=this.match(t.patterns[e.p]);return n||e.o?(n&&e.c&&(this.captures[e.c]=n),e.e?this.emit(e.e):n||""):null;case"sequence":const i=this.pos,r={...this.captures},s=[];for(const n of e.r){const e=this.execRule("string"==typeof n?t.rules[t.ruleIds[n]]:n);if(null===e)return this.pos=i,this.captures=r,null;s.push(e)}return e.e?this.emit(e.e):s.join("");case"choice":for(const n of e.r){const e=this.pos,i=this.execRule("string"==typeof n?t.rules[t.ruleIds[n]]:n);if(null!==i)return i;this.pos=e}return null;case"repetition":const o=[];for(;this.input.length>this.pos;){const n=this.execRule(t.rules[t.ruleIds[e.r]]);if(null===n)break;o.push(n)}return o.join("");case"until":const l=this.scanUntil(t.patterns[e.p]);return e.c&&(this.captures[e.c]=l),"inline"===e.pr&&(this.captures[e.c]=this.parseInline(l)),l;case"until_fence":const a=this.input.indexOf("\n"+this.captures.marker,this.pos),c=-1!==a?this.input.slice(this.pos,a):this.input.slice(this.pos);return this.pos=-1!==a?a+1:this.input.length,e.c&&(this.captures[e.c]=c),c;case"balanced_brackets":return this.parseBalancedBrackets(e);case"list_items":return this.parseListItems(e.o);case"table_row":return this.parseTableRow();case"table_rows":return this.parseTableRows();case"paragraph_lines":return this.parseParagraphLines(e);case"backreference":return this.match(this.captures[e.ref])||null}return null}match(t){if("string"==typeof t){if(this.input.startsWith(t,this.pos))return this.pos+=t.length,t}else if(t instanceof RegExp){const e=this.input.slice(this.pos).match(t);if(e&&0===e.index)return this.pos+=e[0].length,e[1]||e[0]}return null}scanUntil(t){const e=this.pos;if("string"==typeof t){const e=this.input.indexOf(t,this.pos);this.pos=-1===e?this.input.length:e}else{const e=this.input.slice(this.pos).match(t);this.pos=e?this.pos+e.index:this.input.length}return this.input.slice(e,this.pos)}parseBalancedBrackets(t){let e=1,n="";for(;this.input.length>this.pos&&e>0;){const t=this.input[this.pos++];if("["===t)e++;else if("]"===t&&(e--,0===e))break;n+=t}return t.c&&(this.captures[t.c]="inline"===t.pr?this.parseInline(n):n),n}parseListItems(t){const e=t?/^\d+\. /:/^[*+-] /,n=[];for(n.push(this.scanUntil(/\n|$/)),this.match(/\n/);this.input.length>this.pos&&"\n"!==this.input[this.pos];)if(this.match(e))n.push(this.scanUntil(/\n|$/)),this.match(/\n/);else{if(!this.match(/^ {2,3}/))break;n.push(this.scanUntil(/\n|$/)),this.match(/\n/)}return n.map(t=>{const e=this.parseInline(t);return"<li"+this.getAttr("li")+">"+e+"</li>"}).join("\n")}parseTableRow(){const t=this.scanUntil(/\n|$/);this.match(/\n/);let e=t.split("|");return e[0].trim()||e.shift(),e[e.length-1].trim()||e.pop(),e.map(t=>t.trim())}parseTableRows(){const t=[];for(;this.input.length>this.pos&&this.input.slice(this.pos).includes("|");)t.push(this.parseTableRow());return t}parseParagraphLines(t){const e=[];for(;this.input.length>this.pos&&"\n"!==this.input[this.pos];){const t=this.scanUntil(/\n|$/);t.trim()&&e.push(t),this.match(/\n/)}const n=e.join("\n");return t.c&&(this.captures[t.c]="inline"===t.pr?this.parseInline(n):n),n}parseInline(t){if(!t)return"";let n="",i=0;for(;t.length>i;){let r=!1;for(const[e,s]of[[/^\\/,()=>(i++,"\\")],[/^\*\*/,()=>this.parseDelimited(t,i,"**","strong")],[/^__/,()=>this.parseDelimited(t,i,"__","strong")],[/^\*/,()=>this.parseDelimited(t,i,"*","em")],[/^_/,()=>this.parseDelimited(t,i,"_","em")],[/^~~/,()=>this.parseDelimited(t,i,"~~","del")],[/^`/,()=>this.parseCode(t,i)],[/^!\[/,()=>this.parseImage(t,i)],[/^\[/,()=>this.parseLink(t,i)]])if(e.test(t.slice(i))){const t=s();if(t){n+=t.html,i=t.pos,r=!0;break}}r||(n+=e(t[i++]))}return n}parseDelimited(t,e,n,i){const r=t.indexOf(n,e+=n.length);if(-1===r)return null;const s=this.parseInline(t.slice(e,r));return{html:"<"+i+this.getAttr(i)+">"+s+"</"+i+">",pos:r+n.length}}parseCode(t,n){n++;const i=t.indexOf("`",n);if(-1===i)return null;const r=t.slice(n,i);return{html:"<code"+this.getAttr("code")+">"+e(r)+"</code>",pos:i+1}}parseLink(t,n){n++;let i=1,r="";for(;t.length>n&&i>0;){if("["===t[n])i++;else if("]"===t[n]&&(i--,0===i))break;r+=t[n++]}if(0===i&&"("===t[++n]){n++;const i=t.indexOf(")",n);if(-1!==i){const s=t.slice(n,i);return{html:"<a"+this.getAttr("a")+' href="'+e(this.sanitizeUrl(s))+'">'+this.parseInline(r)+"</a>",pos:i+1}}}return null}parseImage(t,n){n+=2;let i=1,r="";for(;t.length>n&&i>0;){if("["===t[n])i++;else if("]"===t[n]&&(i--,0===i))break;r+=t[n++]}if(0===i&&"("===t[++n]){n++;const i=t.indexOf(")",n);if(-1!==i){const s=t.slice(n,i);return{html:"<img"+this.getAttr("img")+' src="'+e(this.sanitizeUrl(s))+'" alt="'+e(r)+'">',pos:i+1}}}return null}emit(n){const i=t.templates[n];if(!i)return"";let r=i;for(const[t,e]of Object.entries(this.captures))r=r.replace(RegExp("{"+t+"}","g"),e||"");if("heading"===n&&(r=r.replace(/{level}/g,(this.captures.level||"#").length)),"fence"===n){const t=this.captures.lang,n=t&&!this.opts.inline_styles?' class="language-'+t.trim()+'"':"";if(r=r.replace(/{lang}/g,n),r=r.replace(/{content}/g,e(this.captures.content||"")),this.opts.fence_plugin){const e=this.opts.fence_plugin(this.captures.content,t);if(void 0!==e)return e}}return r=r.replace(/{attr}/g,""),r=r.replace(/{rel}/g,""),r}processBlocks(t){let e="";for(let n=0;t.length>n;n++){let i=t[n];if(n>0&&i.startsWith("<p")){const e=t[n-1];(e.startsWith("<h")||(e.endsWith("</ol>")||e.endsWith("</ul>"))&&i.match(/^<p[^>]*>\s{3,}/))&&(i=i.replace(/^<p[^>]*>/,"\n"))}if(e+=i,t.length-1>n){const i=t[n],r=t[n+1];(i.startsWith("<h")&&r.startsWith("<h")||i.startsWith("<blockquote")&&r.startsWith("<blockquote"))&&(e+="\n")}}return e}getAttr(t){if("p"===t)return"";if(this.opts.inline_styles){const e={h1:"font-size:2em;font-weight:600;margin:.67em 0",h2:"font-size:1.5em;font-weight:600;margin:.83em 0",h3:"font-size:1.25em;font-weight:600;margin:1em 0",h4:"font-size:1em;font-weight:600;margin:1.33em 0",h5:"font-size:.875em;font-weight:600;margin:1.67em 0",h6:"font-size:.85em;font-weight:600;margin:2em 0",pre:"background:#f4f4f4;padding:10px;border-radius:4px;overflow-x:auto;margin:1em 0",code:"background:#f0f0f0;padding:2px 4px;border-radius:3px;font-family:monospace",blockquote:"border-left:4px solid #ddd;margin-left:0;padding-left:1em",table:"border-collapse:collapse;width:100%;margin:1em 0",th:"border:1px solid #ddd;padding:8px;background-color:#f2f2f2;font-weight:bold;text-align:left",td:"border:1px solid #ddd;padding:8px;text-align:left",hr:"border:none;border-top:1px solid #ddd;margin:1em 0",img:"max-width:100%;height:auto",a:"color:#06c;text-decoration:underline",strong:"font-weight:bold",em:"font-style:italic",del:"text-decoration:line-through",ul:"margin:.5em 0;padding-left:2em",ol:"margin:.5em 0;padding-left:2em",li:"margin:.25em 0",br:"",p:"margin:1em 0"}[t];return e?' style="'+e+'"':""}return' class="'+this.opts.class_prefix+t+'"'}sanitizeUrl(t){if(!t)return"";const e=t.trim();if(this.opts.allow_unsafe_urls)return e;const n=e.toLowerCase();return n.startsWith("javascript:")||n.startsWith("vbscript:")||n.startsWith("data:")&&!n.startsWith("data:image/")?"#":e}}export default function i(t,e={}){return new n(e).parse(t)}i.version="1.0.6dev1",i.emitStyles=function(t="quikdown-"){const e={h1:"font-size:2em;font-weight:600;margin:.67em 0",h2:"font-size:1.5em;font-weight:600;margin:.83em 0",h3:"font-size:1.25em;font-weight:600;margin:1em 0",h4:"font-size:1em;font-weight:600;margin:1.33em 0",h5:"font-size:.875em;font-weight:600;margin:1.67em 0",h6:"font-size:.85em;font-weight:600;margin:2em 0",pre:"background:#f4f4f4;padding:10px;border-radius:4px;overflow-x:auto;margin:1em 0",code:"background:#f0f0f0;padding:2px 4px;border-radius:3px;font-family:monospace",blockquote:"border-left:4px solid #ddd;margin-left:0;padding-left:1em",table:"border-collapse:collapse;width:100%;margin:1em 0",th:"border:1px solid #ddd;padding:8px;background-color:#f2f2f2;font-weight:bold;text-align:left",td:"border:1px solid #ddd;padding:8px;text-align:left",hr:"border:none;border-top:1px solid #ddd;margin:1em 0",img:"max-width:100%;height:auto",a:"color:#06c;text-decoration:underline",strong:"font-weight:bold",em:"font-style:italic",del:"text-decoration:line-through",ul:"margin:.5em 0;padding-left:2em",ol:"margin:.5em 0;padding-left:2em",li:"margin:.25em 0",br:"",p:"margin:1em 0"};let n="";for(const[i,r]of Object.entries(e))r&&(n+="."+t+i+" { "+r+" }\n");return n},i.configure=function(t){return function(e){return i(e,t)}},"undefined"!=typeof module&&module.exports?module.exports=i:"function"==typeof define&&define.amd?define([],()=>i):"undefined"!=typeof globalThis&&(globalThis.quikdown_lex=i);