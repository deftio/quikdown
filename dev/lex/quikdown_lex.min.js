const t={h1:"font-size:2em;font-weight:600;margin:.67em 0",h2:"font-size:1.5em;font-weight:600;margin:.83em 0",h3:"font-size:1.25em;font-weight:600;margin:1em 0",h4:"font-size:1em;font-weight:600;margin:1.33em 0",h5:"font-size:.875em;font-weight:600;margin:1.67em 0",h6:"font-size:.85em;font-weight:600;margin:2em 0",pre:"background:#f4f4f4;padding:10px;border-radius:4px;overflow-x:auto;margin:1em 0",code:"background:#f0f0f0;padding:2px 4px;border-radius:3px;font-family:monospace",blockquote:"border-left:4px solid #ddd;margin-left:0;padding-left:1em",table:"border-collapse:collapse;width:100%;margin:1em 0",th:"border:1px solid #ddd;padding:8px;background-color:#f2f2f2;font-weight:bold;text-align:left",td:"border:1px solid #ddd;padding:8px;text-align:left",hr:"border:none;border-top:1px solid #ddd;margin:1em 0",img:"max-width:100%;height:auto",a:"color:#06c;text-decoration:underline",strong:"font-weight:bold",em:"font-style:italic",del:"text-decoration:line-through",ul:"margin:.5em 0;padding-left:2em",ol:"margin:.5em 0;padding-left:2em",li:"margin:.25em 0",br:"",p:"margin:1em 0"},n=t=>{const n={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};let e="";for(let i=0;t.length>i;i++)e+=n[t[i]]||t[i];return e};class e{constructor(t){this.input=t,this.pos=0}peek(){return this.input.slice(this.pos)}advance(t=1){const n=this.input.slice(this.pos,this.pos+t);return this.pos+=t,n}match(t){const n="string"==typeof t?this.input.startsWith(t,this.pos)&&t:this.input.slice(this.pos).match(t)?.[0];return n?this.advance(n.length):null}scanUntil(t){const n=this.pos,e="string"==typeof t?this.input.indexOf(t,this.pos):(this.input.slice(this.pos).match(t)?.index??-1)+this.pos;return this.pos=this.pos>e?this.input.length:e,this.input.slice(n,this.pos)}atEnd(){return this.pos>=this.input.length}rest(){return this.input.slice(this.pos)}}class i{constructor(t={}){this.opts={inline_styles:t.inline_styles||!1,class_prefix:t.class_prefix||"quikdown-",fence_plugin:t.fence_plugin||null,bidirectional:t.bidirectional||!1,lazy_linefeeds:t.lazy_linefeeds||!1,allow_unsafe_urls:t.allow_unsafe_urls||!1}}scanLine(t){const n=t.scanUntil(/\n|$/);return t.match(/\n/),n}collectLines(t,n){const e=[];for(;!t.atEnd()&&n(t);)e.push(this.scanLine(t));return e}parseDelimited(t,e,i){const s=t.scanUntil(e);return t.match(e)?`<${i}${this.getAttr(i)}>${this.parseInline(s)}</${i}>`:n(e)+(s?this.parseInline(s):"")}parseBracketed(t,n,e){let i=1,s="";for(;!t.atEnd()&&i>0;){const n=t.advance();if("["===n)i++;else if("]"===n&&(i--,0===i))break;s+=n}if(0===i&&t.match("(")){const i=t.scanUntil(")");if(t.match(")"))return i||n?e(s,i):"["+this.parseInline(s)+"]()"}return n+"["+(s?this.parseInline(s):"")}parse(t){if(!t||"string"!=typeof t)return"";const n=new e(t),i=[];for(;!n.atEnd();){if(n.match(/^\n/))continue;const t=this.parseBlock(n);t&&i.push(t)}let s="";for(let t=0;i.length>t;t++){let n=i[t];if(t>0&&n.startsWith("<p>")){const e=i[t-1];(e.startsWith("<h")||(e.endsWith("</ol>")||e.endsWith("</ul>"))&&n.match(/^<p[^>]*>\s{3,}/))&&(n=n.replace(/^<p[^>]*>/,"\n"))}if(s+=n,i.length-1>t){const n=i[t],e=i[t+1];(n.startsWith("<h")&&e.startsWith("<h")||n.startsWith("<blockquote")&&e.startsWith("<blockquote"))&&(s+="\n")}}return s}parseBlock(t){return this.parseHeading(t)||this.parseFence(t)||this.parseHR(t)||this.parseBlockquote(t)||this.parseList(t)||this.parseTable(t)||this.parseParagraph(t)}parseHeading(t){const n=t.match(/^#{1,6}(?= )/);if(!n)return null;const e=n.length;t.match(/ +/);const i=this.scanLine(t).replace(/\s*#+\s*$/,""),s="h"+e;return`<${s}${this.getAttr(s)}>${this.parseInline(i)}</${s}>`}parseFence(t){const e=t.match(/^```|^~~~/);if(!e)return null;const i=this.scanLine(t).trim();let s=t.scanUntil(RegExp("^"+e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"m"));if(s.endsWith("\n")&&(s=s.slice(0,-1)),t.match(e),t.match(/[^\n]*\n?/),this.opts.fence_plugin){const t=this.opts.fence_plugin(s,i);if(void 0!==t)return t}const r=i&&!this.opts.inline_styles?` class="language-${i}"`:"";return`<pre${this.getAttr("pre")}><code${r}>${n(s)}</code></pre>`}parseHR(t){return t.match(/^---+\s*$/m)?(t.match(/\n/),`<hr${this.getAttr("hr")}>`):null}parseBlockquote(t){if(!t.match(/^> ?/))return null;const n=this.scanLine(t);return`<blockquote${this.getAttr("blockquote")}>${this.parseInline(n)}</blockquote>`}parseList(t){const n=t.match(/^\d+\. /),i=t.match(/^[*+-] /);if(!n&&!i)return null;const s=n?"ol":"ul",r=[];for(r.push(t.scanUntil(/\n|$/)),t.match(/\n/);!t.atEnd();){const e=t.peek();if(e.startsWith("\n"))break;if(n&&e.match(/^\d+\. /))t.match(/^\d+\. /),r.push(t.scanUntil(/\n|$/)),t.match(/\n/);else if(i&&e.match(/^[*+-] /))t.match(/^[*+-] /),r.push(t.scanUntil(/\n|$/)),t.match(/\n/);else{if(!e.match(/^ {2,3}(?:\d+\. |[*+-] )/))break;r.push(t.scanUntil(/\n|$/)),t.match(/\n/)}}let o=`<${s}${this.getAttr(s)}>`,h=0;for(;r.length>h;){const t=r[h];if(t.match(/^ {2,3}(?:\d+\. |[*+-] )/)){const t=[];for(;r.length>h&&r[h].match(/^ {2,3}/);){const n=r[h].match(/^( {2,3})/)[1].length;t.push(r[h].slice(n)),h++}const n=new e(t.join("\n")),i=this.parseList(n);i&&(o+="\n"+i);continue}if(o+="\n",!n&&t.match(/^\[[ xX]\]/)){const n=/^\[[xX]\]/.test(t),e=t.slice(3).trim();o+=`<li class="quikdown-task-item"><input type="checkbox" class="quikdown-task-checkbox"${n?" checked":""} disabled> ${this.parseInline(e)}</li>`}else o+=`<li${this.getAttr("li")}>${this.parseInline(t)}</li>`;h++}return o+=`\n</${s}>`,o}parseTable(t){const n=t.pos;if(!t.peek().includes("|"))return null;const e=this.scanLine(t),i=this.scanLine(t);if(!i.match(/^[\s\|:\-]+$/))return t.pos=n,null;const s=t=>{let n=t.split("|");return""!==n[0]&&""!==n[0].trim()||n.shift(),""!==n[n.length-1]&&""!==n[n.length-1].trim()||n.pop(),n.map(t=>t.trim())},r=s(e),o=s(i).map(t=>t.startsWith(":")&&t.endsWith(":")?"center":t.endsWith(":")?"right":"left"),h=[];for(;!t.atEnd()&&t.peek().includes("|");)h.push(s(this.scanLine(t)));let l=`<table${this.getAttr("table")}>\n<thead${this.getAttr("thead")}>\n<tr${this.getAttr("tr")}>\n`;for(let t=0;r.length>t;t++){const n="left"!==o[t]?` style="text-align:${o[t]}"`:"";l+=`<th${this.getAttr("th")}${n}>${this.parseInline(r[t])}</th>\n`}if(l+="</tr>\n</thead>",h.length){l+=`\n<tbody${this.getAttr("tbody")}>\n`;for(const t of h){l+=`<tr${this.getAttr("tr")}>\n`;for(let n=0;t.length>n;n++){const e="left"!==o[n]?` style="text-align:${o[n]}"`:"";l+=`<td${this.getAttr("td")}${e}>${this.parseInline(t[n]||"")}</td>\n`}l+="</tr>\n"}l+="</tbody>"}return l+="\n</table>",l}parseParagraph(t){const n=[];for(;!t.atEnd()&&!t.peek().startsWith("\n");){const e=t.scanUntil(/\n|$/);e.trim()&&n.push(e),t.match(/\n/)}if(!n.length)return null;const e=this.opts.lazy_linefeeds?n.map((t,e)=>n.length-1>e?this.parseInline(t)+"<br>":this.parseInline(t)).join(""):this.parseInline(n.join("\n"));return`<p${this.getAttr("p")}>${e}</p>`}parseInline(t){t=t.replace(/  \n/g,"§BR§\n");const i=new e(t);let s="";for(;!i.atEnd();){if(0===i.pos||"\n"===i.input[i.pos-1]){const t=i.peek().match(/^(#{1,6}) (.*?)(?:\n|$)/);if(t){i.advance(t[0].length);const n=t[1].length,e=t[2].replace(/\s*#+\s*$/,"");i.pos>t[0].length&&(s+="\n"),s+=`<h${n}${this.getAttr("h"+n)}>${this.parseInline(e)}</h${n}>`,i.atEnd()||(s+="\n");continue}if(i.match("> ")){const t=i.scanUntil(/\n|$/);s&&!s.endsWith("\n")&&(s+="\n"),s+=`<blockquote${this.getAttr("blockquote")}>${this.parseInline(t)}</blockquote>`,i.match(/\n/)&&(s+="\n");continue}}if(i.match("\\")){s+="\\";const t=i.peek()[0];if(t&&"[]".includes(t)){s+=i.advance();continue}}else if(i.match("**")||i.match("__")){const t=i.input.slice(i.pos-2,i.pos);s+=this.parseDelimited(i,t,"strong")}else if(i.match("*")||i.match("_"))s+=this.parseDelimited(i,i.input[i.pos-1],"em");else if(i.match("~~"))s+=this.parseDelimited(i,"~~","del");else if(i.match("`")){const t=i.scanUntil("`");if(i.match("`")){s+=`<code${this.getAttr("code")}>${n(t)}</code>`;continue}s+="`"}else i.match("![")?s+=this.parseBracketed(i,"!",(t,e)=>{const i=this.sanitizeUrl(e);return`<img${this.getAttr("img")} src="${n(i)}" alt="${n(t)}">`}):i.match("[")?s+=this.parseBracketed(i,"",(t,e)=>{const i=this.sanitizeUrl(e),s=i.startsWith("http")?' rel="noopener noreferrer"':"";return`<a${this.getAttr("a")} href="${n(i)}"${s}>${this.parseInline(t)}</a>`}):i.match("<")?s+=n("<"):s+=n(i.advance())}return s=s.replace(/§BR§/g,this.getBrTag()),s}getAttr(n){if("p"===n)return"";if(this.opts.inline_styles){const e=t[n]||"";return e?` style="${e}"`:""}return` class="${this.opts.class_prefix}${n}"`}getBrTag(){return`<br${this.getAttr("br")}>`}sanitizeUrl(t){if(!t)return"";const n=t.trim();if(this.opts.allow_unsafe_urls)return n;const e=n.toLowerCase();return e.startsWith("javascript:")||e.startsWith("vbscript:")||e.startsWith("data:")?e.startsWith("data:image/")?n:"#":n}}function s(t,n={}){return new i(n).parse(t)}s.version="undefined",s.emitStyles=function(n="quikdown-"){let e="";for(const[i,s]of Object.entries(t))s&&(e+=`.${n}${i} { ${s} }\n`);return e},s.configure=function(t){return function(n){return s(n,t)}},"undefined"!=typeof module&&module.exports?module.exports=s:"function"==typeof define&&define.amd?define([],function(){return s}):"undefined"!=typeof globalThis&&(globalThis.quikdown_lex=s);export default s;