const t=t=>{const e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};let n="";for(let i=0;t.length>i;i++)n+=e[t[i]]||t[i];return n};class e{constructor(t){this.input=t,this.pos=0}peek(){return this.input.slice(this.pos)}advance(t=1){const e=this.input.slice(this.pos,this.pos+t);return this.pos+=t,e}match(t){if("string"==typeof t){if(this.input.startsWith(t,this.pos))return this.advance(t.length)}else if(t instanceof RegExp){const e=this.input.slice(this.pos).match(t);if(e&&0===e.index)return this.advance(e[0].length)}return null}scanUntil(t){const e=this.pos;if("string"==typeof t){const e=this.input.indexOf(t,this.pos);this.pos=-1===e?this.input.length:e}else{const e=this.input.slice(this.pos).match(t);this.pos=e?this.pos+e.index:this.input.length}return this.input.slice(e,this.pos)}atEnd(){return this.pos>=this.input.length}}class n{constructor(t={}){this.opts={inline_styles:t.inline_styles||!1,class_prefix:t.class_prefix||"quikdown-",fence_plugin:t.fence_plugin||null,lazy_linefeeds:t.lazy_linefeeds||!1,allow_unsafe_urls:t.allow_unsafe_urls||!1},this.initializeStates()}initializeStates(){this.charMap={"#":"heading","`":"fence","~":"fence","-":"hr",">":"blockquote","*":"listOrEmphasis","+":"list",0:"orderedList",1:"orderedList",2:"orderedList",3:"orderedList",4:"orderedList",5:"orderedList",6:"orderedList",7:"orderedList",8:"orderedList",9:"orderedList","|":"table"},this.blockPatterns=[{name:"heading",pattern:/^#{1,6}(?= )/},{name:"fence",pattern:/^```|^~~~/},{name:"hr",pattern:/^---+\s*$/},{name:"blockquote",pattern:/^> ?/},{name:"orderedList",pattern:/^\d+\. /},{name:"unorderedList",pattern:/^[*+-] /},{name:"table",pattern:/\|/}],this.inlinePatterns={escape:/^\\/,strong:/^(\*\*|__)/,emphasis:/^(\*|_)/,strikethrough:/^~~/,code:/^`/,image:/^!\[/,link:/^\[/}}parse(t){if(!t||"string"!=typeof t)return"";const n=new e(t),i=[];for(;!n.atEnd();){if(n.match(/^\n/))continue;const t=this.parseBlock(n);t&&i.push(t)}return this.processBlocks(i)}processBlocks(t){let e="";for(let n=0;t.length>n;n++){let i=t[n];if(n>0&&i.startsWith("<p>")){const e=t[n-1];(e.startsWith("<h")||(e.endsWith("</ol>")||e.endsWith("</ul>"))&&i.match(/^<p[^>]*>\s{3,}/))&&(i=i.replace(/^<p[^>]*>/,"\n"))}if(e+=i,t.length-1>n){const i=t[n],r=t[n+1];(i.startsWith("<h")&&r.startsWith("<h")||i.startsWith("<blockquote")&&r.startsWith("<blockquote"))&&(e+="\n")}}return e}parseBlock(t){const e=t.peek()[0];if(this.charMap[e]){const n=this["parse"+this.charMap[e].charAt(0).toUpperCase()+this.charMap[e].slice(1)];if(n){const e=n.call(this,t);if(e)return e}}return this.parseHeading(t)||this.parseFence(t)||this.parseHR(t)||this.parseBlockquote(t)||this.parseList(t)||this.parseTable(t)||this.parseParagraph(t)}parseHeading(t){const e=t.match(/^#{1,6}(?= )/);if(!e)return null;const n=e.length;t.match(/ +/);const i=this.scanLine(t).replace(/\s*#+\s*$/,""),r="h"+n;return`<${r}${this.getAttr(r)}>${this.parseInline(i)}</${r}>`}parseFence(e){const n=e.match(/^```|^~~~/);if(!n)return null;const i=this.scanLine(e).trim(),r=e.input.indexOf("\n"+n,e.pos);let s;if(-1!==r?(s=e.input.slice(e.pos,r),e.pos=r+1):(s=e.input.slice(e.pos),e.pos=e.input.length),s.endsWith("\n")&&(s=s.slice(0,-1)),e.match(n),e.match(/[^\n]*\n?/),this.opts.fence_plugin){const t=this.opts.fence_plugin(s,i);if(void 0!==t)return t}const o=i&&!this.opts.inline_styles?` class="language-${i}"`:"";return`<pre${this.getAttr("pre")}><code${o}>${t(s)}</code></pre>`}parseHR(t){return t.match(/^---+\s*$/m)?(t.match(/\n/),`<hr${this.getAttr("hr")}>`):null}parseBlockquote(t){if(!t.match(/^> ?/))return null;const e=this.scanLine(t);return`<blockquote${this.getAttr("blockquote")}>${this.parseInline(e)}</blockquote>`}parseList(t){const n=t.match(/^\d+\. /),i=t.match(/^[*+-] /);if(!n&&!i)return null;const r=n?"ol":"ul",s=[];for(s.push(t.scanUntil(/\n|$/)),t.match(/\n/);!t.atEnd();){const e=t.peek();if(e.startsWith("\n"))break;if(n&&e.match(/^\d+\. /))t.match(/^\d+\. /),s.push(t.scanUntil(/\n|$/)),t.match(/\n/);else if(i&&e.match(/^[*+-] /))t.match(/^[*+-] /),s.push(t.scanUntil(/\n|$/)),t.match(/\n/);else{if(!e.match(/^ {2,3}(?:\d+\. |[*+-] )/))break;s.push(t.scanUntil(/\n|$/)),t.match(/\n/)}}let o=`<${r}${this.getAttr(r)}>`;for(let t=0;s.length>t;t++){const i=s[t];if(i.match(/^ {2,3}(?:\d+\. |[*+-] )/)){const n=[];for(;s.length>t&&s[t].match(/^ {2,3}/);){const e=s[t].match(/^( {2,3})/)[1].length;n.push(s[t].slice(e)),t++}const i=new e(n.join("\n")),r=this.parseList(i);r&&(o+="\n"+r),t--;continue}if(o+="\n",!n&&i.match(/^\[[ xX]\]/)){const t=/^\[[xX]\]/.test(i),e=i.slice(3).trim();o+=`<li class="quikdown-task-item"><input type="checkbox" class="quikdown-task-checkbox"${t?" checked":""} disabled> ${this.parseInline(e)}</li>`}else o+=`<li${this.getAttr("li")}>${this.parseInline(i)}</li>`}return o+=`\n</${r}>`,o}parseListOrEmphasis(t){return t.peek().match(/^\* /)?this.parseList(t):null}parseOrderedList(t){return this.parseList(t)}parseTable(t){const e=t.pos;if(!t.peek().includes("|"))return null;const n=this.scanLine(t),i=this.scanLine(t);if(!i.match(/^[\s\|:\-]+$/))return t.pos=e,null;const r=t=>{let e=t.split("|");return""!==e[0]&&""!==e[0].trim()||e.shift(),""!==e[e.length-1]&&""!==e[e.length-1].trim()||e.pop(),e.map(t=>t.trim())},s=r(n),o=r(i).map(t=>t.startsWith(":")&&t.endsWith(":")?"center":t.endsWith(":")?"right":"left"),h=[];for(;!t.atEnd()&&t.peek().includes("|");)h.push(r(this.scanLine(t)));let d=`<table${this.getAttr("table")}>\n<thead${this.getAttr("thead")}>\n<tr${this.getAttr("tr")}>\n`;for(let t=0;s.length>t;t++){const e="left"!==o[t]?` style="text-align:${o[t]}"`:"";d+=`<th${this.getAttr("th")}${e}>${this.parseInline(s[t])}</th>\n`}if(d+="</tr>\n</thead>",h.length){d+=`\n<tbody${this.getAttr("tbody")}>\n`;for(const t of h){d+=`<tr${this.getAttr("tr")}>\n`;for(let e=0;t.length>e;e++){const n="left"!==o[e]?` style="text-align:${o[e]}"`:"";d+=`<td${this.getAttr("td")}${n}>${this.parseInline(t[e]||"")}</td>\n`}d+="</tr>\n"}d+="</tbody>"}return d+="\n</table>",d}parseParagraph(t){const e=[];for(;!t.atEnd()&&!t.peek().startsWith("\n");){const n=t.scanUntil(/\n|$/);n.trim()&&e.push(n),t.match(/\n/)}if(!e.length)return null;const n=this.opts.lazy_linefeeds?e.map((t,n)=>e.length-1>n?this.parseInline(t)+"<br>":this.parseInline(t)).join(""):this.parseInline(e.join("\n"));return`<p${this.getAttr("p")}>${n}</p>`}parseInline(n){n=n.replace(/  \n/g,"§BR§\n");const i=new e(n);let r="";for(;!i.atEnd();){if(0===i.pos||"\n"===n[i.pos-1]){const t=i.peek().match(/^(#{1,6}) (.*?)(?:\n|$)/);if(t){i.advance(t[0].length);const e=t[1].length,n=t[2].replace(/\s*#+\s*$/,"");i.pos>t[0].length&&(r+="\n"),r+=`<h${e}${this.getAttr("h"+e)}>${this.parseInline(n)}</h${e}>`,i.atEnd()||(r+="\n");continue}if(i.match("> ")){const t=i.scanUntil(/\n|$/);r&&!r.endsWith("\n")&&(r+="\n"),r+=`<blockquote${this.getAttr("blockquote")}>${this.parseInline(t)}</blockquote>`,i.match(/\n/)&&(r+="\n");continue}}if(i.match("\\")){r+="\\";const t=i.peek()[0];t&&"[]".includes(t)&&(r+=i.advance());continue}if(i.match("**")||i.match("__")){const e=n.slice(i.pos-2,i.pos),s=i.scanUntil(e);i.match(e)?r+=`<strong${this.getAttr("strong")}>${this.parseInline(s)}</strong>`:r+=t(e)+(s?this.parseInline(s):"");continue}if(i.match("*")||i.match("_")){const e=n[i.pos-1],s=i.scanUntil(e);i.match(e)?r+=`<em${this.getAttr("em")}>${this.parseInline(s)}</em>`:r+=t(e)+(s?this.parseInline(s):"");continue}if(i.match("~~")){const t=i.scanUntil("~~");i.match("~~")?r+=`<del${this.getAttr("del")}>${this.parseInline(t)}</del>`:r+="~~"+(t?this.parseInline(t):"");continue}if(i.match("`")){const e=i.scanUntil("`");i.match("`")?r+=`<code${this.getAttr("code")}>${t(e)}</code>`:r+="`";continue}i.match("![")?r+=this.parseBracketed(i,"!",(e,n)=>{const i=this.sanitizeUrl(n);return`<img${this.getAttr("img")} src="${t(i)}" alt="${t(e)}">`}):i.match("[")?r+=this.parseBracketed(i,"",(e,n)=>{const i=this.sanitizeUrl(n),r=i.startsWith("http")?' rel="noopener noreferrer"':"";return`<a${this.getAttr("a")} href="${t(i)}"${r}>${this.parseInline(e)}</a>`}):i.match("<")?r+=t("<"):r+=t(i.advance())}return r.replace(/§BR§/g,this.getBrTag())}parseBracketed(t,e,n){let i=1,r="";for(;!t.atEnd()&&i>0;){const e=t.advance();if("["===e)i++;else if("]"===e&&(i--,0===i))break;r+=e}if(0===i&&t.match("(")){const i=t.scanUntil(")");if(t.match(")"))return i||e?n(r,i):"["+this.parseInline(r)+"]()"}return e+"["+(r?this.parseInline(r):"")}scanLine(t){const e=t.scanUntil(/\n|$/);return t.match(/\n/),e}getAttr(t){if("p"===t)return"";if(this.opts.inline_styles){const e={h1:"font-size:2em;font-weight:600;margin:.67em 0",h2:"font-size:1.5em;font-weight:600;margin:.83em 0",h3:"font-size:1.25em;font-weight:600;margin:1em 0",h4:"font-size:1em;font-weight:600;margin:1.33em 0",h5:"font-size:.875em;font-weight:600;margin:1.67em 0",h6:"font-size:.85em;font-weight:600;margin:2em 0",pre:"background:#f4f4f4;padding:10px;border-radius:4px;overflow-x:auto;margin:1em 0",code:"background:#f0f0f0;padding:2px 4px;border-radius:3px;font-family:monospace",blockquote:"border-left:4px solid #ddd;margin-left:0;padding-left:1em",table:"border-collapse:collapse;width:100%;margin:1em 0",th:"border:1px solid #ddd;padding:8px;background-color:#f2f2f2;font-weight:bold;text-align:left",td:"border:1px solid #ddd;padding:8px;text-align:left",hr:"border:none;border-top:1px solid #ddd;margin:1em 0",img:"max-width:100%;height:auto",a:"color:#06c;text-decoration:underline",strong:"font-weight:bold",em:"font-style:italic",del:"text-decoration:line-through",ul:"margin:.5em 0;padding-left:2em",ol:"margin:.5em 0;padding-left:2em",li:"margin:.25em 0",br:"",p:"margin:1em 0"}[t]||"";return e?` style="${e}"`:""}return` class="${this.opts.class_prefix}${t}"`}getBrTag(){return`<br${this.getAttr("br")}>`}sanitizeUrl(t){if(!t)return"";const e=t.trim();if(this.opts.allow_unsafe_urls)return e;const n=e.toLowerCase();return n.startsWith("javascript:")||n.startsWith("vbscript:")||n.startsWith("data:")?n.startsWith("data:image/")?e:"#":e}}export default function i(t,e={}){return new n(e).parse(t)}i.version="1.0.6dev1",i.emitStyles=function(t="quikdown-"){const e={h1:"font-size:2em;font-weight:600;margin:.67em 0",h2:"font-size:1.5em;font-weight:600;margin:.83em 0",h3:"font-size:1.25em;font-weight:600;margin:1em 0",h4:"font-size:1em;font-weight:600;margin:1.33em 0",h5:"font-size:.875em;font-weight:600;margin:1.67em 0",h6:"font-size:.85em;font-weight:600;margin:2em 0",pre:"background:#f4f4f4;padding:10px;border-radius:4px;overflow-x:auto;margin:1em 0",code:"background:#f0f0f0;padding:2px 4px;border-radius:3px;font-family:monospace",blockquote:"border-left:4px solid #ddd;margin-left:0;padding-left:1em",table:"border-collapse:collapse;width:100%;margin:1em 0",th:"border:1px solid #ddd;padding:8px;background-color:#f2f2f2;font-weight:bold;text-align:left",td:"border:1px solid #ddd;padding:8px;text-align:left",hr:"border:none;border-top:1px solid #ddd;margin:1em 0",img:"max-width:100%;height:auto",a:"color:#06c;text-decoration:underline",strong:"font-weight:bold",em:"font-style:italic",del:"text-decoration:line-through",ul:"margin:.5em 0;padding-left:2em",ol:"margin:.5em 0;padding-left:2em",li:"margin:.25em 0",br:"",p:"margin:1em 0"};let n="";for(const[i,r]of Object.entries(e))r&&(n+=`.${t}${i} { ${r} }\n`);return n},i.configure=function(t){return function(e){return i(e,t)}},"undefined"!=typeof module&&module.exports?module.exports=i:"function"==typeof define&&define.amd?define([],function(){return i}):"undefined"!=typeof globalThis&&(globalThis.quikdown_lex=i);