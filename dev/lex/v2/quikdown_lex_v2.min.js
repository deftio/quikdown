const t={h1:"font-size:2em;font-weight:600;margin:.67em 0",h2:"font-size:1.5em;font-weight:600;margin:.83em 0",h3:"font-size:1.25em;font-weight:600;margin:1em 0",h4:"font-size:1em;font-weight:600;margin:1.33em 0",h5:"font-size:.875em;font-weight:600;margin:1.67em 0",h6:"font-size:.85em;font-weight:600;margin:2em 0",pre:"background:#f4f4f4;padding:10px;border-radius:4px;overflow-x:auto;margin:1em 0",code:"background:#f0f0f0;padding:2px 4px;border-radius:3px;font-family:monospace",blockquote:"border-left:4px solid #ddd;margin-left:0;padding-left:1em",table:"border-collapse:collapse;width:100%;margin:1em 0",th:"border:1px solid #ddd;padding:8px;background-color:#f2f2f2;font-weight:bold;text-align:left",td:"border:1px solid #ddd;padding:8px;text-align:left",hr:"border:none;border-top:1px solid #ddd;margin:1em 0",img:"max-width:100%;height:auto",a:"color:#06c;text-decoration:underline",strong:"font-weight:bold",em:"font-style:italic",del:"text-decoration:line-through",ul:"margin:.5em 0;padding-left:2em",ol:"margin:.5em 0;padding-left:2em",li:"margin:.25em 0",br:"",p:"margin:1em 0"},e=t=>{const e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};let n="";for(let i=0;t.length>i;i++)n+=e[t[i]]||t[i];return n};class n{constructor(t){this.input=t,this.pos=0}peek(){return this.input.slice(this.pos)}advance(t=1){const e=this.input.slice(this.pos,this.pos+t);return this.pos+=t,e}match(t){const e="string"==typeof t?this.input.startsWith(t,this.pos)&&t:this.input.slice(this.pos).match(t)?.[0];return e?this.advance(e.length):null}scanUntil(t){const e=this.pos,n="string"==typeof t?this.input.indexOf(t,this.pos):(this.input.slice(this.pos).match(t)?.index??-1)+this.pos;return this.pos=this.pos>n?this.input.length:n,this.input.slice(e,this.pos)}atEnd(){return this.pos>=this.input.length}rest(){return this.input.slice(this.pos)}}class i{constructor(t={}){this.opts={inline_styles:t.inline_styles||!1,class_prefix:t.class_prefix||"quikdown-",fence_plugin:t.fence_plugin||null,bidirectional:t.bidirectional||!1,lazy_linefeeds:t.lazy_linefeeds||!1,allow_unsafe_urls:t.allow_unsafe_urls||!1}}scanLine(t){const e=t.scanUntil(/\n|$/);return t.match(/\n/),e}collectLines(t,e){const n=[];for(;!t.atEnd()&&e(t);)n.push(this.scanLine(t));return n}parseDelimited(t,n,i){const s=t.scanUntil(n);return t.match(n)?`<${i}${this.getAttr(i)}>${this.parseInline(s)}</${i}>`:e(n)+(s?this.parseInline(s):"")}parseBracketed(t,e,n){let i=1,s="";for(;!t.atEnd()&&i>0;){const e=t.advance();if("["===e)i++;else if("]"===e&&(i--,0===i))break;s+=e}if(0===i&&t.match("(")){const i=t.scanUntil(")");if(t.match(")"))return i||e?n(s,i):"["+this.parseInline(s)+"]()"}return e+"["+(s?this.parseInline(s):"")}parse(t){if(!t||"string"!=typeof t)return"";const e=new n(t),i=[];for(;!e.atEnd();){if(e.match(/^\n/))continue;const t=this.parseBlock(e);t&&i.push(t)}let s="";for(let t=0;i.length>t;t++){let e=i[t];if(t>0&&e.startsWith("<p>")){const n=i[t-1];(n.startsWith("<h")||(n.endsWith("</ol>")||n.endsWith("</ul>"))&&e.match(/^<p[^>]*>\s{3,}/))&&(e=e.replace(/^<p[^>]*>/,"\n"))}if(s+=e,i.length-1>t){const e=i[t],n=i[t+1];(e.startsWith("<h")&&n.startsWith("<h")||e.startsWith("<blockquote")&&n.startsWith("<blockquote"))&&(s+="\n")}}return s}parseBlock(t){return this.parseHeading(t)||this.parseFence(t)||this.parseHR(t)||this.parseBlockquote(t)||this.parseList(t)||this.parseTable(t)||this.parseParagraph(t)}parseHeading(t){const e=t.match(/^#{1,6}(?= )/);if(!e)return null;const n=e.length;t.match(/ +/);const i=this.scanLine(t).replace(/\s*#+\s*$/,""),s="h"+n;return`<${s}${this.getAttr(s)}>${this.parseInline(i)}</${s}>`}parseFence(t){const n=t.match(/^```|^~~~/);if(!n)return null;const i=this.scanLine(t).trim();let s=t.scanUntil(RegExp("^"+n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"m"));if(s.endsWith("\n")&&(s=s.slice(0,-1)),t.match(n),t.match(/[^\n]*\n?/),this.opts.fence_plugin){const t=this.opts.fence_plugin(s,i);if(void 0!==t)return t}const r=i&&!this.opts.inline_styles?` class="language-${i}"`:"";return`<pre${this.getAttr("pre")}><code${r}>${e(s)}</code></pre>`}parseHR(t){return t.match(/^---+\s*$/m)?(t.match(/\n/),`<hr${this.getAttr("hr")}>`):null}parseBlockquote(t){if(!t.match(/^> ?/))return null;const e=this.scanLine(t);return`<blockquote${this.getAttr("blockquote")}>${this.parseInline(e)}</blockquote>`}parseList(t){const e=t.match(/^\d+\. /),i=t.match(/^[*+-] /);if(!e&&!i)return null;const s=e?"ol":"ul",r=[];for(r.push(t.scanUntil(/\n|$/)),t.match(/\n/);!t.atEnd();){const n=t.peek();if(n.startsWith("\n"))break;if(e&&n.match(/^\d+\. /))t.match(/^\d+\. /),r.push(t.scanUntil(/\n|$/)),t.match(/\n/);else if(i&&n.match(/^[*+-] /))t.match(/^[*+-] /),r.push(t.scanUntil(/\n|$/)),t.match(/\n/);else{if(!n.match(/^ {2,3}(?:\d+\. |[*+-] )/))break;r.push(t.scanUntil(/\n|$/)),t.match(/\n/)}}let o=`<${s}${this.getAttr(s)}>`,h=0;for(;r.length>h;){const t=r[h];if(t.match(/^ {2,3}(?:\d+\. |[*+-] )/)){const t=[];for(;r.length>h&&r[h].match(/^ {2,3}/);){const e=r[h].match(/^( {2,3})/)[1].length;t.push(r[h].slice(e)),h++}const e=new n(t.join("\n")),i=this.parseList(e);i&&(o+="\n"+i);continue}if(o+="\n",!e&&t.match(/^\[[ xX]\]/)){const e=/^\[[xX]\]/.test(t),n=t.slice(3).trim();o+=`<li class="quikdown-task-item"><input type="checkbox" class="quikdown-task-checkbox"${e?" checked":""} disabled> ${this.parseInline(n)}</li>`}else o+=`<li${this.getAttr("li")}>${this.parseInline(t)}</li>`;h++}return o+=`\n</${s}>`,o}parseTable(t){const e=t.pos;if(!t.peek().includes("|"))return null;const n=this.scanLine(t),i=this.scanLine(t);if(!i.match(/^[\s\|:\-]+$/))return t.pos=e,null;const s=t=>{let e=t.split("|");return""!==e[0]&&""!==e[0].trim()||e.shift(),""!==e[e.length-1]&&""!==e[e.length-1].trim()||e.pop(),e.map(t=>t.trim())},r=s(n),o=s(i).map(t=>t.startsWith(":")&&t.endsWith(":")?"center":t.endsWith(":")?"right":"left"),h=[];for(;!t.atEnd()&&t.peek().includes("|");)h.push(s(this.scanLine(t)));let l=`<table${this.getAttr("table")}>\n<thead${this.getAttr("thead")}>\n<tr${this.getAttr("tr")}>\n`;for(let t=0;r.length>t;t++){const e="left"!==o[t]?` style="text-align:${o[t]}"`:"";l+=`<th${this.getAttr("th")}${e}>${this.parseInline(r[t])}</th>\n`}if(l+="</tr>\n</thead>",h.length){l+=`\n<tbody${this.getAttr("tbody")}>\n`;for(const t of h){l+=`<tr${this.getAttr("tr")}>\n`;for(let e=0;t.length>e;e++){const n="left"!==o[e]?` style="text-align:${o[e]}"`:"";l+=`<td${this.getAttr("td")}${n}>${this.parseInline(t[e]||"")}</td>\n`}l+="</tr>\n"}l+="</tbody>"}return l+="\n</table>",l}parseParagraph(t){const e=[];for(;!t.atEnd()&&!t.peek().startsWith("\n");){const n=t.scanUntil(/\n|$/);n.trim()&&e.push(n),t.match(/\n/)}if(!e.length)return null;const n=this.opts.lazy_linefeeds?e.map((t,n)=>e.length-1>n?this.parseInline(t)+"<br>":this.parseInline(t)).join(""):this.parseInline(e.join("\n"));return`<p${this.getAttr("p")}>${n}</p>`}parseInline(t){t=t.replace(/  \n/g,"§BR§\n");const i=new n(t);let s="";for(;!i.atEnd();){if(0===i.pos||"\n"===i.input[i.pos-1]){const t=i.peek().match(/^(#{1,6}) (.*?)(?:\n|$)/);if(t){i.advance(t[0].length);const e=t[1].length,n=t[2].replace(/\s*#+\s*$/,"");i.pos>t[0].length&&(s+="\n"),s+=`<h${e}${this.getAttr("h"+e)}>${this.parseInline(n)}</h${e}>`,i.atEnd()||(s+="\n");continue}if(i.match("> ")){const t=i.scanUntil(/\n|$/);s&&!s.endsWith("\n")&&(s+="\n"),s+=`<blockquote${this.getAttr("blockquote")}>${this.parseInline(t)}</blockquote>`,i.match(/\n/)&&(s+="\n");continue}}if(i.match("\\")){s+="\\";const t=i.peek()[0];if(t&&"[]".includes(t)){s+=i.advance();continue}}else if(i.match("**")||i.match("__")){const t=i.input.slice(i.pos-2,i.pos);s+=this.parseDelimited(i,t,"strong")}else if(i.match("*")||i.match("_"))s+=this.parseDelimited(i,i.input[i.pos-1],"em");else if(i.match("~~"))s+=this.parseDelimited(i,"~~","del");else if(i.match("`")){const t=i.scanUntil("`");if(i.match("`")){s+=`<code${this.getAttr("code")}>${e(t)}</code>`;continue}s+="`"}else i.match("![")?s+=this.parseBracketed(i,"!",(t,n)=>{const i=this.sanitizeUrl(n);return`<img${this.getAttr("img")} src="${e(i)}" alt="${e(t)}">`}):i.match("[")?s+=this.parseBracketed(i,"",(t,n)=>{const i=this.sanitizeUrl(n),s=i.startsWith("http")?' rel="noopener noreferrer"':"";return`<a${this.getAttr("a")} href="${e(i)}"${s}>${this.parseInline(t)}</a>`}):i.match("<")?s+=e("<"):s+=e(i.advance())}return s=s.replace(/§BR§/g,this.getBrTag()),s}getAttr(e){if("p"===e)return"";if(this.opts.inline_styles){const n=t[e]||"";return n?` style="${n}"`:""}return` class="${this.opts.class_prefix}${e}"`}getBrTag(){return`<br${this.getAttr("br")}>`}sanitizeUrl(t){if(!t)return"";const e=t.trim();if(this.opts.allow_unsafe_urls)return e;const n=e.toLowerCase();return n.startsWith("javascript:")||n.startsWith("vbscript:")||n.startsWith("data:")?n.startsWith("data:image/")?e:"#":e}}function s(t,e={}){return new i(e).parse(t)}s.version="1.0.6dev1",s.emitStyles=function(e="quikdown-"){let n="";for(const[i,s]of Object.entries(t))s&&(n+=`.${e}${i} { ${s} }\n`);return n},s.configure=function(t){return function(e){return s(e,t)}},"undefined"!=typeof module&&module.exports?module.exports=s:"function"==typeof define&&define.amd?define([],function(){return s}):"undefined"!=typeof globalThis&&(globalThis.quikdown_lex=s);export default s;