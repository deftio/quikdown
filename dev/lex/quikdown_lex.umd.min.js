!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).quikdown_lex=t()}(this,function(){"use strict";const e="STAR",t="UNDERSCORE",s="BACKTICK",i="TILDE",n="HASH",p="PIPE",l="MINUS",h="PLUS",a="EQUALS",r="GT",o="LT",c="BANG",u="LBRACKET",f="RBRACKET",y="LPAREN",d="RPAREN",k="COLON",g="SPACE",v="TAB",m="NEWLINE",$="DOT",b="DIGIT",x="TEXT",A="EOF",_={h1:"font-size:2em;font-weight:600;margin:.67em 0",h2:"font-size:1.5em;font-weight:600;margin:.83em 0",h3:"font-size:1.25em;font-weight:600;margin:1em 0",h4:"font-size:1em;font-weight:600;margin:1.33em 0",h5:"font-size:.875em;font-weight:600;margin:1.67em 0",h6:"font-size:.85em;font-weight:600;margin:2em 0",pre:"background:#f4f4f4;padding:10px;border-radius:4px;overflow-x:auto;margin:1em 0",code:"background:#f0f0f0;padding:2px 4px;border-radius:3px;font-family:monospace",blockquote:"border-left:4px solid #ddd;margin-left:0;padding-left:1em",table:"border-collapse:collapse;width:100%;margin:1em 0",th:"border:1px solid #ddd;padding:8px;background-color:#f2f2f2;font-weight:bold;text-align:left",td:"border:1px solid #ddd;padding:8px;text-align:left",hr:"border:none;border-top:1px solid #ddd;margin:1em 0",img:"max-width:100%;height:auto",a:"color:#06c;text-decoration:underline",strong:"font-weight:bold",em:"font-style:italic",del:"text-decoration:line-through",ul:"margin:.5em 0;padding-left:2em",ol:"margin:.5em 0;padding-left:2em",li:"margin:.25em 0",br:"",p:"margin:1em 0"};class w{constructor(e){this.input=e,this.pos=0,this.line=1,this.col=1}peek(e=0){return this.input[this.pos+e]||null}advance(){const e=this.input[this.pos];return"\n"===e?(this.line++,this.col=1):this.col++,this.pos++,e}*tokenize(){for(;this.pos<this.input.length;){this.peek();const e=this.nextToken();e&&(yield e)}yield{type:A,value:"",line:this.line,col:this.col}}nextToken(){const A=this.peek(),_=this.line,w=this.col;switch(A){case"*":return this.advance(),{type:e,value:"*",line:_,col:w};case"_":return this.advance(),{type:t,value:"_",line:_,col:w};case"`":return this.advance(),{type:s,value:"`",line:_,col:w};case"~":return this.advance(),{type:i,value:"~",line:_,col:w};case"#":return this.advance(),{type:n,value:"#",line:_,col:w};case"|":return this.advance(),{type:p,value:"|",line:_,col:w};case"-":return this.advance(),{type:l,value:"-",line:_,col:w};case"+":return this.advance(),{type:h,value:"+",line:_,col:w};case"=":return this.advance(),{type:a,value:"=",line:_,col:w};case">":return this.advance(),{type:r,value:">",line:_,col:w};case"<":return this.advance(),{type:o,value:"<",line:_,col:w};case"!":return this.advance(),{type:c,value:"!",line:_,col:w};case"[":return this.advance(),{type:u,value:"[",line:_,col:w};case"]":return this.advance(),{type:f,value:"]",line:_,col:w};case"(":return this.advance(),{type:y,value:"(",line:_,col:w};case")":return this.advance(),{type:d,value:")",line:_,col:w};case":":return this.advance(),{type:k,value:":",line:_,col:w};case" ":return this.advance(),{type:g,value:" ",line:_,col:w};case"\t":return this.advance(),{type:v,value:"\t",line:_,col:w};case"\n":return this.advance(),{type:m,value:"\n",line:_,col:w};case".":return this.advance(),{type:$,value:".",line:_,col:w};default:if(A>="0"&&A<="9")return this.advance(),{type:b,value:A,line:_,col:w};let I="";for(;this.pos<this.input.length;){const e=this.peek();if("*_`~#|-+=><![](): \t\n.".includes(e)||e>="0"&&e<="9")break;I+=this.advance()}return I?{type:x,value:I,line:_,col:w}:(this.advance(),null)}}}class I{constructor(e,t={}){this.tokens=Array.from(e),this.pos=0,this.opts={inline_styles:t.inline_styles||!1,class_prefix:t.class_prefix||"quikdown-",fence_plugin:t.fence_plugin||null,bidirectional:t.bidirectional||!1,lazy_linefeeds:t.lazy_linefeeds||!1,allow_unsafe_urls:t.allow_unsafe_urls||!1},this.output=[]}peek(e=0){return this.tokens[this.pos+e]||{type:A}}advance(){return this.tokens[this.pos++]}consume(e){return this.peek().type===e?this.advance():null}consumeSequence(...e){for(let t=0;t<e.length;t++)if(this.peek(t).type!==e[t])return!1;for(let t=0;t<e.length;t++)this.advance();return!0}getAttr(e,t=""){if(this.opts.inline_styles){const s=_[e]||"",i=t?`${s};${t}`:s;return i?` style="${i}"`:""}const s=` class="${this.opts.class_prefix}${e}"`;return t?`${s} style="${t}"`:s}dataQd(e){return this.opts.bidirectional?` data-qd="${this.escapeHtml(e)}"`:""}escapeHtml(e){const t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};let s="";for(let i=0;i<e.length;i++){const n=e[i];s+=t[n]||n}return s}sanitizeUrl(e){if(!e)return"";const t=e.trim();if(this.opts.allow_unsafe_urls)return t;const s=t.toLowerCase();return s.startsWith("javascript:")||s.startsWith("vbscript:")||s.startsWith("data:")?s.startsWith("data:image/")?t:"#":t}parse(){for(;this.peek().type!==A;)this.parseBlock();return this.output.join("")}parseBlock(){this.peek().type!==m?this.parseHeading()||this.parseHorizontalRule()||this.parseFence()||this.parseBlockquote()||this.parseList()||this.parseTable()||this.parseParagraph():this.advance()}parseHeading(){const e=this.pos;let t=0;for(;this.peek().type===n&&t<6;)this.advance(),t++;if(0===t)return!1;if(this.peek().type!==g)return this.pos=e,!1;for(;this.peek().type===g;)this.advance();let s="";for(;this.peek().type!==m&&this.peek().type!==A;){s+=this.advance().value}this.consume(m);let i=s;for(;i.endsWith("#")||i.endsWith(" ");)i=i.slice(0,-1);return this.output.push(`<h${t}${this.getAttr("h"+t)}>${this.parseInline(i)}</h${t}>`),!0}parseHorizontalRule(){const s=this.pos;let i=0,n=null;const p=this.peek();if(p.type===l)n=l;else if(p.type===e)n=e;else{if(p.type!==t)return!1;n=t}for(;this.pos<this.tokens.length;)if(this.peek().type===n)this.advance(),i++;else{if(this.peek().type!==g){if(this.peek().type===m||this.peek().type===A)break;return this.pos=s,!1}this.advance()}return i>=3?(this.consume(m),this.output.push(`<hr${this.getAttr("hr")}>`),!0):(this.pos=s,!1)}parseFence(){const e=this.pos;let t=null,n=0;if(this.peek().type===s)t=s;else{if(this.peek().type!==i)return!1;t=i}for(;this.peek().type===t;)this.advance(),n++;if(n<3)return this.pos=e,!1;let p="";for(;this.peek().type!==m&&this.peek().type!==A;)p+=this.advance().value;p=p.trim(),this.consume(m);let l,h="",a=!0,r=0;for(;this.pos<this.tokens.length;)if(a&&this.peek().type===t){let e=this.pos;for(r=0;this.peek().type===t;)this.advance(),r++;if(r>=n){for(;this.peek().type!==m&&this.peek().type!==A;)this.advance();this.peek().type===m&&this.advance();break}this.pos=e,h+=this.advance().value,a=!1}else{const e=this.advance();h+=e.value,a=e.type===m}if(this.opts.fence_plugin&&(l=this.opts.fence_plugin(h,p)),null==l){const e=!this.opts.inline_styles&&p?` class="language-${p}"`:"",t=this.opts.inline_styles?this.getAttr("code"):e;l=`<pre${this.getAttr("pre")}><code${t}>${this.escapeHtml(h)}</code></pre>`}return this.output.push(l),!0}parseBlockquote(){if(this.peek().type!==r)return!1;this.advance(),this.peek().type===g&&this.advance();let e="";for(;this.peek().type!==m&&this.peek().type!==A;)e+=this.advance().value;this.consume(m);let t=[e];for(;this.peek().type===r;){this.advance(),this.peek().type===g&&this.advance();let e="";for(;this.peek().type!==m&&this.peek().type!==A;)e+=this.advance().value;t.push(e),this.consume(m)}const s=z(t.join("\n"),this.opts);return this.output.push(`<blockquote${this.getAttr("blockquote")}>${s}</blockquote>`),!0}parseList(){const t=this.pos;let s=0;for(;this.peek().type===g||this.peek().type===v;){s+=this.advance().type===v?4:1}let i=!1,n="";if(this.peek().type===e||this.peek().type===l||this.peek().type===h)n=this.advance().value;else{if(this.peek().type!==b)return this.pos=t,!1;{let e="";for(;this.peek().type===b;)e+=this.advance().value;if(this.peek().type!==$)return this.pos=t,!1;this.advance(),n=e+".",i=!0}}if(this.peek().type!==g)return this.pos=t,!1;this.advance();const p=i?"ol":"ul",a=[];let r="";for(;this.peek().type!==m&&this.peek().type!==A;)r+=this.advance().value;for(a.push(r),this.consume(m);;){const t=this.pos;let s=0;for(;this.peek().type===g||this.peek().type===v;){s+=this.advance().type===v?4:1}let n=!1;if(i){if(this.peek().type===b){for(;this.peek().type===b;)this.advance();this.peek().type===$&&(this.advance(),n=!0)}}else this.peek().type!==e&&this.peek().type!==l&&this.peek().type!==h||(this.advance(),n=!0);if(!n||this.peek().type!==g){this.pos=t;break}{this.advance();let e="";for(;this.peek().type!==m&&this.peek().type!==A;)e+=this.advance().value;a.push(e),this.consume(m)}}let o=`<${p}${this.getAttr(p)}>`;for(const e of a){let t="",s=e;if(!i&&e.startsWith("[")&&e.length>3)if("x"!==e[1]&&"X"!==e[1]&&" "!==e[1]||"]"!==e[2])o+=`\n<li${this.getAttr("li")}>${this.parseInline(s)}</li>`;else{const i="x"===e[1].toLowerCase(),n=this.opts.inline_styles?' style="margin-right:.5em"':` class="${this.opts.class_prefix}task-checkbox"`,p=this.opts.inline_styles?' style="list-style:none"':` class="${this.opts.class_prefix}task-item"`;t=`<input type="checkbox"${n}${i?" checked":""} disabled> `,s=e.substring(3).trim(),o+=`\n<li${p}>${t}${this.parseInline(s)}</li>`}else o+=`\n<li${this.getAttr("li")}>${this.parseInline(s)}</li>`}return o+=`\n</${p}>`,this.output.push(o),!0}parseTable(){const e=this.pos,t=[];let s=null,i=!1,n=this.pos;for(;this.peek().type!==m&&this.peek().type!==A;){if(this.peek().type===p){i=!0;break}this.advance()}if(this.pos=n,!i)return!1;const l=()=>{const e=[];let t="";for(this.peek().type===p&&this.advance();this.peek().type!==m&&this.peek().type!==A;)this.peek().type===p?(e.push(t.trim()),t="",this.advance()):t+=this.advance().value;return(t.trim()||0===e.length)&&e.push(t.trim()),e},h=l();if(0===h.length||1===h.length)return this.pos=e,!1;this.consume(m);this.pos;const a=l();let r=!0;s=[];for(const e of a){let t=e.trim(),i="left";t.startsWith(":")?(t=t.substring(1),t.endsWith(":")?(t=t.substring(0,t.length-1),i="center"):i="left"):t.endsWith(":")&&(t=t.substring(0,t.length-1),i="right");let n=!0;for(let e=0;e<t.length;e++)if("-"!==t[e]){n=!1;break}if(!n||0===t.length){r=!1;break}s.push(i)}if(!r)return this.pos=e,!1;for(this.consume(m),t.push(h);this.pos<this.tokens.length;){const e=this.pos;let s=!1,i=this.pos;for(;this.peek().type!==m&&this.peek().type!==A;){if(this.peek().type===p){s=!0;break}this.advance()}if(this.pos=i,!s)break;const n=l();if(0===n.length){this.pos=e;break}t.push(n),this.consume(m)}let o=`<table${this.getAttr("table")}>`;if(t.length>0){o+="\n<thead>\n<tr>";for(let e=0;e<t[0].length;e++){const i=s&&"left"!==s[e]?` style="text-align:${s[e]}"`:"";o+=`\n<th${this.getAttr("th")}${i}>${this.parseInline(t[0][e])}</th>`}o+="\n</tr>\n</thead>"}if(t.length>1){o+="\n<tbody>";for(let e=1;e<t.length;e++){o+="\n<tr>";for(let i=0;i<t[e].length;i++){const n=s&&"left"!==s[i]?` style="text-align:${s[i]}"`:"";o+=`\n<td${this.getAttr("td")}${n}>${this.parseInline(t[e][i])}</td>`}o+="\n</tr>"}o+="\n</tbody>"}return o+="\n</table>",this.output.push(o),!0}parseParagraph(){const p=[];for(;this.pos<this.tokens.length;){this.pos;if(this.peek().type===n||this.peek().type===r||this.peek().type===s&&this.peek(1).type===s&&this.peek(2).type===s||this.peek().type===i&&this.peek(1).type===i&&this.peek(2).type===i)break;if(this.peek().type,this.peek().type===e||this.peek().type===l||this.peek().type===h||this.peek().type===t){let e=this.pos,t=0;const s=this.peek().type;for(;this.peek().type===s||this.peek().type===g;)this.peek().type===s&&t++,this.advance();if(this.pos=e,t>=3&&(this.peek(t).type===m||this.peek(t).type===A))break;if(this.peek(1).type===g)break}if(this.peek().type===b){let e=this.pos;for(;this.peek().type===b;)this.advance();if(this.peek().type===$&&this.peek(1).type===g){this.pos=e;break}this.pos=e}if(this.peek().type===m){if(0===p.length){this.advance();continue}if(this.peek(1).type===m||this.peek(1).type===A)break}let a="";for(;this.peek().type!==m&&this.peek().type!==A;)a+=this.advance().value;if(a.trim()&&p.push(a),this.peek().type!==m)break;this.advance()}if(p.length>0){let e="";e=this.opts.lazy_linefeeds?p.map((e,t)=>{const s=this.parseInline(e);return t<p.length-1?s+`<br${this.getAttr("br")}>`:s}).join(""):this.parseInline(p.join("\n")),this.output.push(`<p${this.getAttr("p")}>${e}</p>`)}}parseInline(n){const p=new w(n),l=Array.from(p.tokenize());let h="",a=0;for(;a<l.length&&l[a].type!==A;){const n=l[a];if(n.type===e)if(l[a+1]&&l[a+1].type===e){let t=a+2,s="";for(;t<l.length-1;){if(l[t].type===e&&l[t+1].type===e){h+=`<strong${this.getAttr("strong")}${this.dataQd("**")}>${this.parseInline(s)}</strong>`,a=t+2;break}s+=l[t].value,t++}t>=l.length-1&&(h+=n.value,a++)}else{let t=a+1,s="";for(;t<l.length;){if(l[t].type===e){h+=`<em${this.getAttr("em")}${this.dataQd("*")}>${this.parseInline(s)}</em>`,a=t+1;break}s+=l[t].value,t++}t>=l.length&&(h+=n.value,a++)}else if(n.type===t)if(l[a+1]&&l[a+1].type===t){let e=a+2,s="";for(;e<l.length-1;){if(l[e].type===t&&l[e+1].type===t){h+=`<strong${this.getAttr("strong")}>${this.parseInline(s)}</strong>`,a=e+2;break}s+=l[e].value,e++}e>=l.length-1&&(h+=n.value,a++)}else{let e=a+1,s="";for(;e<l.length;){if(l[e].type===t){h+=`<em${this.getAttr("em")}>${this.parseInline(s)}</em>`,a=e+1;break}s+=l[e].value,e++}e>=l.length&&(h+=n.value,a++)}else if(n.type===i)if(l[a+1]&&l[a+1].type===i){let e=a+2,t="";for(;e<l.length-1;){if(l[e].type===i&&l[e+1].type===i){h+=`<del${this.getAttr("del")}>${this.parseInline(t)}</del>`,a=e+2;break}t+=l[e].value,e++}e>=l.length-1&&(h+=n.value,a++)}else h+=n.value,a++;else if(n.type===s){let e=a+1,t="";for(;e<l.length;){if(l[e].type===s){h+=`<code${this.getAttr("code")}>${this.escapeHtml(t)}</code>`,a=e+1;break}t+=l[e].value,e++}e>=l.length&&(h+=n.value,a++)}else if(n.type===u)if(a>0&&l[a-1]&&l[a-1].type===c)h+=n.value,a++;else{let e=a+1,t="";for(;e<l.length&&l[e].type!==f;)t+=l[e].value,e++;if(e<l.length&&l[e].type===f)if(e++,e<l.length&&l[e].type===y){e++;let s="";for(;e<l.length&&l[e].type!==d;)s+=l[e].value,e++;if(e<l.length&&l[e].type===d){const i=this.sanitizeUrl(s),n=i.startsWith("http")?' rel="noopener noreferrer"':"";h+=`<a${this.getAttr("a")} href="${i}"${n}>${this.parseInline(t)}</a>`,a=e+1}else h+=n.value,a++}else h+=n.value,a++;else h+=n.value,a++}else if(n.type===c)if(l[a+1]&&l[a+1].type===u){a++;let e=a+1,t="";for(;e<l.length&&l[e].type!==f;)t+=l[e].value,e++;if(e<l.length&&l[e].type===f)if(e++,e<l.length&&l[e].type===y){e++;let s="";for(;e<l.length&&l[e].type!==d;)s+=l[e].value,e++;if(e<l.length&&l[e].type===d){const i=this.sanitizeUrl(s);h+=`<img${this.getAttr("img")} src="${i}" alt="${this.escapeHtml(t)}">`,a=e+1}else h+="!"+l[a].value,a++}else h+="!"+l[a].value,a++;else h+=n.value,a++}else h+=n.value,a++;else if(n.type===o){let e=a+1,t="";for(;e<l.length&&l[e].type!==r;)t+=l[e].value,e++;if(e<l.length&&l[e].type===r)if(t.includes("://")){const s=this.sanitizeUrl(t);h+=`<a${this.getAttr("a")} href="${s}" rel="noopener noreferrer">${t}</a>`,a=e+1}else h+=this.escapeHtml(n.value),a++;else h+=this.escapeHtml(n.value),a++}else n.type===x||n.type===g||n.type===v||n.type===b||n.type,h+=this.escapeHtml(n.value),a++}return h}}function z(e,t={}){if(!e||"string"!=typeof e)return"";const s=new w(e).tokenize();return new I(s,t).parse()}return z.version="1.0.6dev1",z.emitStyles=function(e="quikdown-",t="light"){let s="";for(const[t,i]of Object.entries(_))i&&(s+=`.${e}${t} { ${i} }\n`);return s},z.configure=function(e){return function(t){return z(t,e)}},"undefined"!=typeof module&&module.exports&&(module.exports=z),"undefined"!=typeof window&&(window.quikdown_lex=z),z});