const t={e:[[0,35,1],[0,96,7],[0,126,10],[0,45,13],[0,62,16],[0,42,17],[0,95,19],[0,33,21],[0,91,23],[0,92,24],[0,10,25],[1,35,2],[2,35,3],[3,35,4],[4,35,5],[5,35,6],[7,96,8],[8,96,9],[10,126,11],[11,126,12],[13,45,14],[14,45,15],[17,42,18],[19,95,20],[21,91,22]],t:[[1,1,1],[2,1,2],[3,1,3],[4,1,4],[5,1,5],[6,1,6],[7,15,0],[9,2,0],[11,14,0],[12,2,0],[15,3,0],[16,4,0],[17,12,0],[18,10,0],[19,13,0],[20,11,0],[22,17,0],[23,16,0],[24,18,0],[25,9,0],[26,5,0],[27,6,0],[28,7,0]],p:[[26,0],[27,1],[28,2]],r:[/^\d+\. /,/^[*+-] /,/.*\|.*/]},e=["","<h{L}{A}>{C}</h{L}>","<pre{A}><code{L}>{C}</code></pre>","<hr{A}>","<blockquote{A}>{C}</blockquote>","<ol{A}>{C}</ol>","<ul{A}>{C}</ul>","<table{A}>{C}</table>","<p{A}>{C}</p>","","<strong{A}>{C}</strong>","<strong{A}>{C}</strong>","<em{A}>{C}</em>","<em{A}>{C}</em>","<del{A}>{C}</del>","<code{A}>{C}</code>",'<a{A} href="{U}"{R}>{C}</a>','<img{A} src="{U}" alt="{C}">',"{C}","{C}"],i=t=>{const e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};let i="";for(let n=0;t.length>n;n++)i+=e[t[n]]||t[n];return i};class n{constructor(t,e={}){this.i=t,this.p=0,this.o=e}next(){if(this.p>=this.i.length)return null;let e=0,i=null,n=this.p;for(;this.i.length>this.p;){const r=this.i.charCodeAt(this.p);let s=!1;for(const[a,o,l]of t.e)if(a===e&&o===r){e=l,this.p++,s=!0;for(const[r,s,a]of t.t)r===e&&(i={type:s,meta:a,start:n,end:this.p});break}if(!s)break}if(i)return i;for(const[e,i]of t.p){const n=t.r[i],r=this.i.slice(this.p).match(n);if(r){const i=t.t.find(t=>t[0]===e);if(i){const t={type:i[1],start:this.p,end:this.p+r[0].length};return this.p+=r[0].length,t}}}return{type:19,start:this.p++,end:this.p}}until(t){const e=this.p;if("string"==typeof t){const e=this.i.indexOf(t,this.p);this.p=-1===e?this.i.length:e}else{const e=this.i.slice(this.p).match(t);this.p=e?this.p+e.index:this.i.length}return this.i.slice(e,this.p)}match(t){if("string"==typeof t){if(this.i.startsWith(t,this.p))return this.p+=t.length,t}else{const e=this.i.slice(this.p).match(t);if(e&&0===e.index)return this.p+=e[0].length,e[0]}return null}}class r{constructor(t={}){this.opts={inline_styles:t.inline_styles||!1,class_prefix:t.class_prefix||"quikdown-",fence_plugin:t.fence_plugin||null}}parse(t){if(!t)return"";const i=new n(t,this.opts),r=[];for(;i.i.length>i.p;){const t=i.next();if(!t)break;switch(t.type){case 1:r.push(this.heading(i,t));break;case 2:r.push(this.fence(i));break;case 3:i.match(/\s*$/m)&&(r.push(e[3].replace("{A}",this.attr("hr"))),i.match(/\n/));break;case 4:if(i.match(/ ?/)){const t=i.until(/\n|$/);r.push(e[4].replace("{C}",this.inline(t)).replace("{A}",this.attr("blockquote"))),i.match(/\n/)}break;case 5:case 6:r.push(this.list(i,t.type));break;case 7:r.push(this.table(i));break;case 9:break;default:i.p=t.start,r.push(this.paragraph(i))}}return this.processBlocks(r)}heading(t,i){t.match(/ +/);const n=t.until(/\n|$/).replace(/\s*#+\s*$/,"");return t.match(/\n/),e[1].replace(/{L}/g,i.meta||1).replace("{C}",this.inline(n)).replace("{A}",this.attr("h"+(i.meta||1)))}fence(t){const n=t.until(/\n|$/).trim();t.match(/\n/);const r=t.i.slice(t.p-4,t.p-1),s=t.i.indexOf("\n"+r,t.p),a=-1!==s?t.i.slice(t.p,s):t.i.slice(t.p);if(t.p=-1!==s?s+4:t.i.length,t.match(/[^\n]*\n?/),this.opts.fence_plugin){const t=this.opts.fence_plugin(a,n);if(void 0!==t)return t}const o=n&&!this.opts.inline_styles?' class="language-'+n+'"':"";return e[2].replace("{C}",i(a)).replace("{L}",o).replace("{A}",this.attr("pre"))}list(t,i){const n=[],r=5===i,s=r?/^\d+\. /:/^[*+-] /;do{const e=t.until(/\n|$/);n.push("<li"+this.attr("li")+">"+this.inline(e)+"</li>"),t.match(/\n/)}while(t.match(s));return e[i].replace("{C}",n.join("\n")).replace("{A}",this.attr(r?"ol":"ul"))}table(t){const e=[];for(;t.i.length>t.p&&t.i.slice(t.p).includes("|")&&(e.push(t.until(/\n|$/)),t.match(/\n/),t.i.slice(t.p).includes("|")););if(2>e.length)return"";const i=e.map(t=>{let e=t.split("|");return e[0].trim()||e.shift(),e[e.length-1].trim()||e.pop(),e.map(t=>t.trim())});i[1]&&i[1][0].match(/^[\-:]+$/)&&i.splice(1,1);const n=i.shift();let r="<table"+this.attr("table")+">\n";return r+="<thead>\n<tr>",r+=n.map(t=>"<th"+this.attr("th")+">"+this.inline(t)+"</th>").join(""),r+="</tr>\n</thead>\n",i.length&&(r+="<tbody>\n",r+=i.map(t=>"<tr>"+t.map(t=>"<td"+this.attr("td")+">"+this.inline(t)+"</td>").join("")+"</tr>").join("\n"),r+="\n</tbody>"),r+="\n</table>",r}paragraph(t){const i=[];for(;t.i.length>t.p&&"\n"!==t.i[t.p];){const e=t.until(/\n|$/);e.trim()&&i.push(e),t.match(/\n/);const n=t.next();if(n&&19!==n.type){t.p=n.start;break}}return i.length?e[8].replace("{C}",this.inline(i.join("\n"))).replace("{A}",this.attr("p")):""}inline(t){if(!t)return"";const r=new n(t);let s="";for(;r.i.length>r.p;){const t=r.next();if(!t)break;switch(t.type){case 10:case 11:const n=10===t.type?"**":"__",a=r.until(n);r.match(n)?s+=e[10].replace("{C}",this.inline(a)).replace("{A}",this.attr("strong")):s+=i(n)+this.inline(a);break;case 12:case 13:const o=12===t.type?"*":"_",l=r.until(o);r.match(o)?s+=e[12].replace("{C}",this.inline(l)).replace("{A}",this.attr("em")):s+=i(o)+this.inline(l);break;case 14:const h=r.until("~~");r.match("~~")?s+=e[14].replace("{C}",this.inline(h)).replace("{A}",this.attr("del")):s+="~~"+this.inline(h);break;case 15:const c=r.until("`");r.match("`")?s+=e[15].replace("{C}",i(c)).replace("{A}",this.attr("code")):s+="`";break;case 16:case 17:s+=this.parseLink(r,17===t.type);break;case 18:s+="\\",r.i.length>r.p&&(s+=r.i[r.p++]);break;default:s+=i(r.i.slice(t.start,t.end))}}return s}parseLink(t,n){let r=1,s="";for(;t.i.length>t.p&&r>0;){const e=t.i[t.p++];if("["===e)r++;else if("]"===e&&(r--,0===r))break;s+=e}if(0===r&&t.match("(")){const r=t.until(")");if(t.match(")"))return n?e[17].replace("{U}",i(this.sanitizeUrl(r))).replace("{C}",i(s)).replace("{A}",this.attr("img")):e[16].replace("{U}",i(this.sanitizeUrl(r))).replace("{C}",this.inline(s)).replace("{R}",r.startsWith("http")?' rel="noopener noreferrer"':"").replace("{A}",this.attr("a"))}return(n?"![":"[")+this.inline(s)}processBlocks(t){let e="";for(let i=0;t.length>i;i++){let n=t[i];if(i>0&&n.startsWith("<p")){const e=t[i-1];(e.startsWith("<h")||(e.endsWith("</ol>")||e.endsWith("</ul>"))&&n.match(/^<p[^>]*>\s{3,}/))&&(n=n.replace(/^<p[^>]*>/,"\n"))}if(e+=n,t.length-1>i){const n=t[i],r=t[i+1];(n.startsWith("<h")&&r.startsWith("<h")||n.startsWith("<blockquote")&&r.startsWith("<blockquote"))&&(e+="\n")}}return e}attr(t){if("p"===t)return"";if(this.opts.inline_styles){const e={h1:"font-size:2em;font-weight:600;margin:.67em 0",h2:"font-size:1.5em;font-weight:600;margin:.83em 0",h3:"font-size:1.25em;font-weight:600;margin:1em 0",h4:"font-size:1em;font-weight:600;margin:1.33em 0",h5:"font-size:.875em;font-weight:600;margin:1.67em 0",h6:"font-size:.85em;font-weight:600;margin:2em 0",pre:"background:#f4f4f4;padding:10px;border-radius:4px;overflow-x:auto;margin:1em 0",code:"background:#f0f0f0;padding:2px 4px;border-radius:3px;font-family:monospace",blockquote:"border-left:4px solid #ddd;margin-left:0;padding-left:1em",table:"border-collapse:collapse;width:100%;margin:1em 0",th:"border:1px solid #ddd;padding:8px;background-color:#f2f2f2;font-weight:bold;text-align:left",td:"border:1px solid #ddd;padding:8px;text-align:left",hr:"border:none;border-top:1px solid #ddd;margin:1em 0",img:"max-width:100%;height:auto",a:"color:#06c;text-decoration:underline",strong:"font-weight:bold",em:"font-style:italic",del:"text-decoration:line-through",ul:"margin:.5em 0;padding-left:2em",ol:"margin:.5em 0;padding-left:2em",li:"margin:.25em 0",br:"",p:"margin:1em 0"};return e[t]?' style="'+e[t]+'"':""}return' class="'+this.opts.class_prefix+t+'"'}sanitizeUrl(t){if(!t)return"";const e=t.trim();if(this.opts.allow_unsafe_urls)return e;const i=e.toLowerCase();return i.startsWith("javascript:")||i.startsWith("vbscript:")||i.startsWith("data:")&&!i.startsWith("data:image/")?"#":e}}export default function s(t,e={}){return new r(e).parse(t)}s.version="1.0.6dev1",s.emitStyles=function(t="quikdown-"){const e={h1:"font-size:2em;font-weight:600;margin:.67em 0",h2:"font-size:1.5em;font-weight:600;margin:.83em 0",h3:"font-size:1.25em;font-weight:600;margin:1em 0",h4:"font-size:1em;font-weight:600;margin:1.33em 0",h5:"font-size:.875em;font-weight:600;margin:1.67em 0",h6:"font-size:.85em;font-weight:600;margin:2em 0",pre:"background:#f4f4f4;padding:10px;border-radius:4px;overflow-x:auto;margin:1em 0",code:"background:#f0f0f0;padding:2px 4px;border-radius:3px;font-family:monospace",blockquote:"border-left:4px solid #ddd;margin-left:0;padding-left:1em",table:"border-collapse:collapse;width:100%;margin:1em 0",th:"border:1px solid #ddd;padding:8px;background-color:#f2f2f2;font-weight:bold;text-align:left",td:"border:1px solid #ddd;padding:8px;text-align:left",hr:"border:none;border-top:1px solid #ddd;margin:1em 0",img:"max-width:100%;height:auto",a:"color:#06c;text-decoration:underline",strong:"font-weight:bold",em:"font-style:italic",del:"text-decoration:line-through",ul:"margin:.5em 0;padding-left:2em",ol:"margin:.5em 0;padding-left:2em",li:"margin:.25em 0",br:"",p:"margin:1em 0"};let i="";for(const[n,r]of Object.entries(e))r&&(i+="."+t+n+" { "+r+" }\n");return i},s.configure=function(t){return function(e){return s(e,t)}},"undefined"!=typeof module&&module.exports?module.exports=s:"function"==typeof define&&define.amd?define([],()=>s):"undefined"!=typeof globalThis&&(globalThis.quikdown_lex=s);